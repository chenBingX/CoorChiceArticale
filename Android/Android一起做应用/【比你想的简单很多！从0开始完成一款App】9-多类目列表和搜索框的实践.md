![image](http://upload-images.jianshu.io/upload_images/1869462-4a20be6d7fcbab33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

# [æœ¬ç³»åˆ—æ–‡ç« åˆ—è¡¨](http://www.jianshu.com/nb/8017443)  
# å…ˆå” ä¸¤å¥å—‘
è¿™ä¸ªç³»åˆ—çš„åšå®¢æ˜¯æˆ‘å»å¹´å¼€ç¯‡çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†é€šè¿‡ä¸€ä¸ªç®€å•çš„Appå’Œå¤§å®¶ä¸€èµ·æ¢è®¨ã€æ¢³ç†ä¸€ä¸‹Androidçš„Appè®¾è®¡è¿‡ç¨‹ä¸­çš„æ€æƒ³ï¼Œä¸»è¦ä»¥æ—¶ä¸‹æµè¡Œçš„MVPæ¶æ„ä¸ºåŸºç¡€ã€‚å½“ç„¶ï¼Œæ–‡ä¸­çš„æ€æƒ³å’Œå®ç°æ€è·¯ä»…ä»£è¡¨æˆ‘ä¸ªäººçš„æ€è€ƒï¼Œå¯èƒ½ä¼šæœ‰ä¸åˆç†çš„åœ°æ–¹ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿè¢«å¤§å®¶æ‰€æŒ‡å‡ºï¼Œæ¯•ç«Ÿâ€œåªç¼˜èº«åœ¨æ­¤å±±ä¸­â€ã€‚  

è¿™æ˜¯æ¬¾ç®€å•çš„å…¥é—¨çº§Appï¼Œæˆ‘å¸Œæœ›èƒ½å¸®åŠ©åˆšæ¥è§¦Androidå¼€å‘ä¸ä¹…çš„åŒå­¦èƒ½å¤Ÿè¾ƒä¸ºè½»æ˜“çš„çœ‹æ‡‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿå‚ä¸åˆ°å…³äºAppçš„è®¾è®¡æ€è€ƒä¸­ï¼Œç†Ÿæ‚‰Androidåº”ç”¨å¼€å‘çš„è¿‡ç¨‹ã€‚  

æ­¤å‰è¿™ä¸ªç³»åˆ—çš„æ–‡ç« æˆ‘å·²ç»å†™äº†9ç¯‡äº†ï¼Œæœ€ä¸ºé‡è¦çš„ä¸»é¡µå±•ç¤ºåŠŸèƒ½å·²ç»å®ç°ï¼Œåé¢å°†ä¼šä¸æ–­çš„å®Œå–„ã€ä¿®æ”¹ï¼Œæ·»åŠ æ–°ç‰¹æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­çš„è¿­ä»£è¿‡ç¨‹ã€‚é¦–æ¬¡çœ‹åˆ°æœ¬ç³»åˆ—æ–‡ç« ï¼Œåˆæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»æœ€ä¸Šæ–¹çš„[æœ¬ç³»åˆ—æ–‡ç« åˆ—è¡¨](http://www.jianshu.com/nb/8017443) ï¼Œä½ å°±å¯ä»¥çœ‹ä¸€ä¸‹ä¹‹å‰çš„å†…å®¹ï¼Œç„¶åç»“åˆ[Githubé¡¹ç›®æºç ](https://github.com/chenBingX/OneWeather)ï¼ˆç‚¹å‡»è“è‰²å­—ä½“ä¼ é€è‡³Githubï¼‰çœ‹ä¸€çœ‹ã€‚ç›¸ä¿¡ä½ ç»å¯¹å¯ä»¥å¾ˆå¿«è¿›å…¥çŠ¶æ€çš„ã€‚  

ç”±äºæ²¡æœ‰å¤§æ®µçš„æ—¶é—´æ¥å†™è¿™ä¸ªç³»åˆ—çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½ä¿è¯å®šæœŸæ›´æ–°ã€‚è¿˜è¯·è°…è§£ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¯·å…³æ³¨è¿™ä¸ªç³»åˆ—çš„ä¸“é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘å¯èƒ½ä¼šå…ˆå®ŒæˆGithubçš„çš„ä»£ç ï¼Œæ‰ä¼šæŠ½ç©ºå¼€å§‹å†™ç›¸å…³åšå®¢ã€‚å¦‚æœä½ æƒ³è·å¾—æœ¬é¡¹ç›®çš„æœ€æ–°åŠ¨æ€ï¼Œä½ å¯ä»¥å…³æ³¨[Githubé¡¹ç›®æºç ](https://github.com/chenBingX/OneWeather)ï¼ˆç‚¹å‡»è“è‰²å­—ä½“ä¼ é€è‡³Githubï¼‰ã€‚æˆ‘ä¼šæŠŠè¯¥Appä¸­ä½¿ç”¨åˆ°çš„éƒ¨åˆ†çŸ¥è¯†ç‚¹ç®€å•çš„æä¸€ä¸‹ï¼Œä»¥å¸®åŠ©åˆšæ¥è§¦Androidå¼€å‘çš„åŒå­¦èƒ½å¤Ÿæ›´å¥½çš„é˜…è¯»ã€‚  

å¥½äº†ï¼Œå…³äºåšå®¢è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä¹Ÿåœ¨æ¢ç´¢ä¸­ã€‚æ‰€ä»¥ï¼Œå…¶ä¸­æœ‰ä»€ä¹ˆä¸å¦¥è¿˜è¯·å¤§å®¶æŒ‡æ•™ã€‚æˆ‘å¸Œæœ›èƒ½ä¸æ–­å°è¯•æ”¹è¿›ï¼Œä¸æ–­æŠŠåˆ†äº«çŸ¥è¯†å˜å¾—æ›´è®©äººèˆ’é€‚ï¼Œä»¥å¸å¼•è¶Šæ¥è¶Šå¤šçš„äººå‚ä¸åˆ°é˜Ÿä¼ä¸­ã€‚  
# ç®€è¦å¤©æ°”åˆ—è¡¨åŠä¸»é¡µè”åŠ¨
è€è§„çŸ©ï¼Œå…ˆæ¥ä¸€å¼ æ•ˆæœå›¾ä¾›å¤§å®¶ä¹å‘µä¹å‘µã€‚ 

![image](http://upload-images.jianshu.io/upload_images/1869462-7c579bbb7e7fc0f4.gif?imageMogr2/auto-orient/strip)  
  
## éœ€æ±‚
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦éœ€æ±‚æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š
- ç‚¹å‡»å³ä¸‹è§’å›¾æ ‡æ˜¾ç¤ºç®€è¦å¤©æ°”åˆ—è¡¨ã€‚
- ç®€è¦å¤©æ°”åˆ—è¡¨åŒ…å«ä¸€ä¸ªæœç´¢æ¡†ï¼Œæ€»æ˜¯åœ¨åˆ—è¡¨æœ€ä¸‹æ–¹ï¼Œå¯ä»¥æœç´¢å¹¶æ·»åŠ æ–°åŸå¸‚çš„å¤©æ°”ä¿¡æ¯ã€‚
- ç‚¹å‡»ç®€è¦å¤©æ°”åˆ—è¡¨çš„æ¡ç›®ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„è¯¦æƒ…é¡µã€‚
## æ’¸èµ·è¢–å­å¼€æ•´
### ä¸€ä¸ªé—ç•™çš„é—®é¢˜
æœ€è¿‘åœ¨ç±³4ä¸Šè°ƒè¯•è¿™æ¬¾åº”ç”¨ï¼Œå‘ç°ç™¾åº¦SDKçš„å®šä½æ€»æ˜¯å¤±è´¥ï¼Œæ— æ³•è·å–åˆ°æ­£ç¡®çš„å®šä½ä¿¡æ¯ã€‚è¯´æ˜¯æ²¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªæƒé™ï¼š
```
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
```
æˆ‘æ˜æ˜åœ¨AndroidManifest.xmlä¸­æ³¨å†Œäº†å•Šï¼Œä¸ºä»€ä¹ˆè¿˜è¯´æ²¡æœ‰ï¼è¿™æ‰ç•™æ„åˆ°ï¼Œç±³4æ˜¯6.0çš„ç³»ç»Ÿå•ŠğŸ¤£ï¼  
Android 6.0å¼€å§‹ï¼Œå‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œä¸€äº›ç‰¹æ®Šæƒé™éœ€è¦åŠ¨æ€ç”³è¯·ï¼æ¯”å¦‚å®šä½è¿™ç§æ¯”è¾ƒéšç§çš„æƒé™å°±å±äºç‰¹æ®Šæƒé™çš„èŒƒç•´ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œåŠ¨æ€ç”³è¯·â€å‘¢ï¼Ÿå°±æ˜¯åœ¨ä»£ç é‡Œç”³è¯·å–½ã€‚å…·ä½“çš„å¤§å®¶å¯ä»¥å‚è€ƒè¿™ä¸ªé“¾æ¥[ã€èŠä¸€èŠAndroid 6.0çš„è¿è¡Œæ—¶æƒé™ã€‘http://droidyue.com/blog/2016/01/17/understanding-marshmallow-runtime-permission/index.html](http://droidyue.com/blog/2016/01/17/understanding-marshmallow-runtime-permission/index.html)ï¼Œè®²çš„æ¯”è¾ƒè¯¦ç»†çš„ã€‚  
ä¸‹é¢æˆ‘ç›´æ¥è´´ä¸‹éœ€è¦æ–°å¢åŠ çš„ä»£ç ã€‚  

**SplashActivity**
```
//è¯·æ±‚ç 
 private static final int LOCATION_PERMISSION_REQUEST_CODE = 100;


//initData()æ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼š
@Override
  protected void initData() {
    requestWeatherData();
  }

  private void requestWeatherData() {
   //Apiå¤§äº23ï¼Œå³6.0ä»¥ä¸Šæ‰æ£€æŸ¥æƒé™ã€‚
    if (AppUtils.getSdkVersion() >= 23) {
      checkPermissionAndRequest();
    } else {
      presenter.requestWeatherData();
    }
  }

  private void checkPermissionAndRequest() {
    if (checkLocationPermissions()) {
      String[] permissions = {Manifest.permission.ACCESS_COARSE_LOCATION};
      //å‘èµ·è¯·æ±‚æƒé™
      requestPermissions(permissions, LOCATION_PERMISSION_REQUEST_CODE);
    } else {
      presenter.requestWeatherData();
    }
  }

  private boolean checkLocationPermissions() {
  //Contextæä¾›äº†æƒé™æ£€æŸ¥çš„æ–¹æ³•
    return checkSelfPermission(
        Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED;
  }
  
 //Activityä¸­å¤šäº†ä¸€ä¸ªå›è°ƒï¼Œç”¨äºå¤„ç†ç”¨æˆ·çš„é€‰æ‹©ç»“æœ
 @Override
  public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
    super.onRequestPermissionsResult(requestCode, permissions, grantResults);
    switch (requestCode) {
      // requestCodeå³æ‰€å£°æ˜çš„æƒé™è·å–ç ï¼Œåœ¨checkSelfPermissionæ—¶ä¼ å…¥
      case LOCATION_PERMISSION_REQUEST_CODE:
        if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
          //è·å¾—æƒé™æ—¶æ‰è¿›è¡Œå®šä½è¯·æ±‚
          presenter.requestWeatherData();
        } else {
          //è¯·ä¸€å®šè¦å¯¹æƒé™è¢«æ‹’ç»çš„æƒ…å†µè¿›è¡Œå¤„ç†
          ToastUtil.showShortToast("å®šä½æœåŠ¡éœ€è¦æ‰“å¼€å®šä½æƒé™æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼");
        }
        break;
      default:
        break;
    }
  }
```
**å…·ä½“çš„å¯ä»¥ç‚¹å‡»é“¾æ¥åœ¨[ã€GithubæŸ¥çœ‹å®Œæ•´æºç ã€‘https://github.com/chenBingX/OneWeather/blob/29484fac79c621215e5b520613f8b3efefe184ef/app/src/main/java/com/chenbing/oneweather/View/activitys/MainActivity.java](https://github.com/chenBingX/OneWeather/blob/29484fac79c621215e5b520613f8b3efefe184ef/app/src/main/java/com/chenbing/oneweather/View/activitys/MainActivity.java)**  

  



ä¸‹é¢æ˜¯å¯¹ä½ ç»†å¿ƒæˆç¨‹åº¦çš„è€ƒéªŒã€‚ä¸Šé¢è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ  

ã€‚  
ã€‚  
ã€‚  
å¥½å§ï¼Œä¹Ÿè®¸ä½ å·²ç»å‘ç°ï¼Œå‰é¢æ˜æ˜è¯´éœ€è¦ä¸¤ä¸ªæƒé™ï¼Œå¯æ˜¯æˆ‘å±…ç„¶åªç”³è¯·äº†ä¸€ä¸ªï¼
ä½†æ˜¯ï¼Œæ‰“å¼€Appä½ ä¼šå‘ç°å·²ç»èƒ½æˆåŠŸå®šä½äº†ã€‚Whyï¼Ÿå…¶å®ï¼ŒAndroidå›¢é˜Ÿè¿˜æ˜¯æ¯”è¾ƒä½“è´´çš„ã€‚ç›¸å…³çš„æƒé™æˆ‘ä»¬åªéœ€è¦ç”³è¯·åˆ°ä¸€ä¸ªï¼Œå…¶å®ƒå°±é»˜è®¤è·Ÿç€ä¸€èµ·è·å–åˆ°äº†ã€‚æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦çš„è¿™ä¸¤ä¸ªå®šä½æƒé™ã€‚  

Okï¼Œè¿™ä¸ªå‘å æ—¶å¡«åˆ°è¿™ã€‚  

## éœ€æ±‚å®ç°
æ•ˆæœå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç®€ç•¥å¤©æ°”åˆ—è¡¨ç”¨ä¸€ä¸ª**RecyclerView**å°±èƒ½å®Œç¾å®ç°ã€‚ç¨æœ‰ä¸åŒçš„å°±æ˜¯è¿™ä¸ªRecyclerViewä¸­æœ‰ä¸¤ç§ç±»å‹çš„Itemã€‚
- ä¸€ç§æ˜¯ç®€ç•¥çš„å¤©æ°”ä¿¡æ¯æ¡ç›®
- ä¸€ç§æ˜¯å§‹ç»ˆåœ¨åº•éƒ¨çš„æœç´¢æ¡†

ç†æ¸…æ€è·¯åï¼Œå¯ä»¥å¼€å§‹åŠ¨æ‰‹äº†ã€‚  
ç”±äºåªéœ€è¦æ·»åŠ ä¸€ä¸ª**RecyclerView**å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒç›´æ¥æ”¾åˆ°**MainActivity**ä¸­ï¼Œé€šè¿‡æ˜¾ç¤ºï¼éšè—æ¥è¾¾åˆ°åˆ‡æ¢åˆ°ç›®çš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯è½»é‡åŒ–ï¼Œæ‰€ä»¥å“åº”æ¯”è¾ƒå¿«ã€‚å¹¶ä¸”åæœŸæ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœå°†ä¼šå˜çš„æ›´å®¹æ˜“è¿›è¡Œã€‚é‚£ä¹ˆæœ‰åŒå­¦å¯èƒ½ä¼šè¯´ï¼Œè¿™æ ·ä¸æ˜¯åŠ å¤§**MainActivity**çš„è´Ÿæ‹…äº†å—ï¼Ÿå…¶å®æˆ‘è®¤ä¸ºå¹¶æ²¡æœ‰å¤šå¤§å½±å“ã€‚é¦–å…ˆæˆ‘ä»¬ä¸»è¦çš„æ•°æ®é€‚é…å·¥ä½œæ˜¯åœ¨**Adapter**ä¸­å®Œæˆï¼Œè€Œ**Adapter**åˆä¼šæŠŠæ›´å…·ä½“çš„æ•°æ®é€‚é…å·¥ä½œè½¬äº¤ç»™ç›¸åº”çš„**ItemView**å®Œæˆã€‚**MainActivity**åªæ‰¿æ‹…äº†å‘èµ·æ•°æ®è¯·æ±‚å’Œå°†æ•°æ®ä¼ ç»™**Adapter**çš„å·¥ä½œï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå¢åŠ å¤šå°‘å¤æ‚åº¦ã€‚å½“ç„¶ï¼Œè¿™è°¨ä»£è¡¨æˆ‘çš„æ€è·¯ã€‚è¿™äº‹å„¿ä¹Ÿæ˜¯ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºçš„ã€‚  
### åœ¨activity_main.xmlä¸­æ·»åŠ ä¸€ä¸ªRecyclerViewã€‚
```
<!--å±•ç¤ºå¤©æ°”è¯¦æƒ…çš„ViewPager-->

<android.support.v7.widget.RecyclerView
    android:id="@+id/weather_list"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:visibility="gone"
    tools:visibility="visible"
    tools:listitem="@layout/item_weather_list"
    />
    
<!--åº•éƒ¨æ“ä½œæ -->    
```
- ã€å°çŸ¥è¯†ã€‘ä¸Šé¢ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ç»™RecyclerViewä½¿ç”¨äº†ä¸¤ä¸ªtoolså‰ç¼€çš„å±æ€§ï¼š
```
tools:visibility="visible"
tools:listitem="@layout/item_weather_list"
```
å®ƒä»¬çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä½¿ä½ èƒ½å¤Ÿåœ¨Android Studioçš„Previewä¸­èƒ½å¤Ÿé¢„è§ˆç›¸å…³å±æ€§çš„æ•ˆæœï¼Œä½†æ˜¯å¯¹å®é™…çš„è¿è¡Œæ•ˆæœä¸ä¼šäº§ç”Ÿå½±å“ã€‚è¿™é‡Œtoolsæ‰€ä»£è¡¨çš„å‘½åç©ºé—´ä¸ºï¼š**"http://schemas.android.com/tools"**ã€‚å½“ç„¶ï¼Œè¿™ä¸ªä»£è¡¨åç§°æ˜¯å¯ä»¥éšä¾¿å–çš„ï¼Œå¦‚æœæ„¿æ„å«**CoorChice**ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åªè¦å‘½åç©ºé—´æ˜¯http://schemas.android.com/toolså°±è¡Œäº†ã€‚  
çœ‹çœ‹Previewçš„æ•ˆæœã€‚æˆ‘è®¾ç½®äº†**android:visibility="gone"**ï¼Œä½†æ˜¯åŒæ—¶è®¾ç½®äº†**tools:visibility="visible"**ï¼Œæ‰€ä»¥åœ¨Previewä¸­RecyclerViewé»˜è®¤å¯è§ã€‚ä½†å½“ä½ è¿è¡Œé¡¹ç›®åä¼šå‘ç°ï¼ŒRcyclerViewé»˜è®¤æ˜¯éšè—çš„ã€‚  
![image](http://upload-images.jianshu.io/upload_images/1869462-92f094d7e1924e2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- ã€å°çŸ¥è¯†ã€‘**tools:listitem="@layout/item_weather_list"**çš„ä½œç”¨å¦‚ä½ æ‰€è§ï¼Œä¸Šå›¾ä¸­æ˜¾ç¤ºå‡ºæ¥äº†RecyclerViewçš„ItemViewã€‚å®ƒä¸ä»…ä»…é€‚ç”¨äºRecyclerViewï¼Œå¯¹ListViewç­‰åˆ—è¡¨æ§ä»¶éƒ½é€‚ç”¨ã€‚

ä¸Šé¢è¿™ä¸¤ä¸ªç‰¹æ€§åœ¨å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­å¾ˆç”¨ã€‚æ§ä»¶çš„å…¶ä»–å±æ€§ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åœ¨Previewä¸­é¢„è§ˆæ•ˆæœã€‚  
  
 [ã€activity_main.xml Githubæºç é“¾æ¥ã€‘https://github.com/chenBingX/OneWeather/blob/9d22482f34a387d727d2e6bb9d8a6dd222969b3d/app/src/main/res/layout/activity_main.xml](https://github.com/chenBingX/OneWeather/blob/9d22482f34a387d727d2e6bb9d8a6dd222969b3d/app/src/main/res/layout/activity_main.xml)  
 
---
### åˆå§‹åŒ–RecyclerView
RecyclerViewçš„åˆå§‹åŒ–ä¸»è¦çœ‹ä¸€ä¸‹Adapterå°±å¥½äº†ï¼Œå…¶å®ƒæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚
```
//åˆ›å»ºAdapter
weatherListAdapter = new WeatherListAdapter(this, simpleWeathers);
//ç”±äºç‚¹å‡»Itemä¹‹åçš„ä¸»è¦æ“ä½œéœ€è¦MainActivityä¸­çš„æˆå‘˜å˜é‡è¿›è¡Œï¼Œæ¯”èµ·
//ä¼ å…¥å‚æ•°ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯æ¥å£å›è°ƒã€‚
weatherListAdapter.setOnItemClickListener((v, position) -> {
      AppUtils.hideInputMethod(v);  //éšè—è¾“å…¥æ³•
      showWeatherList(false); //éšè—ç®€ç•¥å¤©æ°”åˆ—è¡¨
      pagerContainer.setCurrentItem(position);  //è·³è½¬åˆ°å¯¹åº”è¯¦æƒ…é¡µ
    });
rvWeatherList.setAdapter(weatherListAdapter);
```
ç®€è¦å¤©æ°”åˆ—è¡¨çš„æ•°æ®æ˜¯åœ¨æ¯ä¸ªåˆ›å»ºæ¯ä¸ªå¤©æ°”è¯¦æƒ…é¡µçš„Fragmentçš„æ—¶å€™æˆªå–ç”Ÿæˆçš„ã€‚è¿™ä¸€éƒ¨åˆ†éœ€è¦ä½ åˆ°æºç ä¸­çœ‹ä¸€ä¸‹ï¼Œæˆ‘å°±ä¸åœ¨è¿™å†™ã€‚[ã€Githubé¡¹ç›®æºç https://github.com/chenBingX/OneWeatherã€‘](https://github.com/chenBingX/OneWeather)  

**WeatherListAdapter.java**  

Adapterä¸­æ¯”è¾ƒé‡è¦çš„å°±æ˜¯åº•éƒ¨æœç´¢æ¡†çš„å®ç°ã€‚æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­çš„å‡ ä¸ªå…³é”®æ–¹æ³•ã€‚
```
@Override
public int getItemCount() {
    //è¿™é‡Œ+1å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä¼ è¿‡æ¥çš„datasæ•°æ®åªåŒ…å«äº†å¤©æ°”ä¿¡æ¯ï¼Œæ‰€ä»¥RecyclerViewçš„
    //Itemæ€»æ•°å› è¯¥æ˜¯datasçš„å¤§å°+ä¸€ä¸ªåº•éƒ¨æœç´¢æ¡†ã€‚
    return datas.size() + 1;  
}

@Override
  public int getItemViewType(int position) {
    int type = ITEM_NORMAL;
    //è®°å¾—Listæ˜¯ä»0å¼€å§‹è®¡æ•°çš„å“¦ï¼æ‰€ä»¥å°äºdatas.size()çš„æ˜¯å¤©æ°”ä¿¡æ¯æ¡ç›®
    //ç­‰äºçš„å°±æŠŠå®ƒå®šä¹‰ä¸ºåº•éƒ¨çš„æœç´¢æ¡†ã€‚
    //è¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»é…åˆä½¿ç”¨ï¼Œä¸ç„¶RecyclerViewçš„positionçš„å€¼æ˜¯å–ä¸åˆ°datas.size()çš„
    //å› ä¸ºpositionä¹Ÿæ˜¯ä»0å¼€å§‹è®¡æ•°
    if (position < datas.size()){
      type = ITEM_NORMAL;
    } else if (position == datas.size()){
      type = ITEM_FOOT;
    }
    return type;
  }
  
  
@Override
  public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
  //è¿™é‡ŒviewTypeçš„å€¼å°±æ¥è‡ªäºgetItemViewTypeæ–¹æ³•
    if (viewType == ITEM_NORMAL){
      //å¤©æ°”ä¿¡æ¯æ¡ç›®
      return new BaseItemViewHolder(new WeatherListItem(mContext));
    } else if (viewType == ITEM_FOOT){
      //åº•éƒ¨æœç´¢æ¡†
      return new BaseItemViewHolder(new WeatherListItemFooter(mContext));

    }
    return null;
  }
  
  @Override
  public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {
    if (getItemViewType(position) == ITEM_NORMAL){
      ((WeatherListItem)holder.itemView).setData(datas.get(position), position); //æŠŠæ•°æ®è®¾ç½®çš„å…·ä½“é€»è¾‘äº¤ç»™ItemViewå¤„ç†ï¼Œä»¥è½»é‡åŒ–Adapter
      //éœ€è¦æ³¨æ„ï¼Œç‚¹å‡»äº‹ä»¶åªéœ€è¦ç»™å¤©æ°”æ¡ç›®è®¾ç½®å°±å¥½ã€‚å¦‚æœç»™åº•éƒ¨æœç´¢æ¡†ä¹Ÿè®¾ç½®å°±Bugäº†
      holder.itemView.setOnClickListener(v -> {
        if (onItemClickListener != null) {
          //å°±æ˜¯ä¸Šé¢åœ¨MainActivityä¸­ç”¨åˆ°çš„å›è°ƒ
          onItemClickListener.onItemClick(v, position);  
        }
      });
    } else if (getItemViewType(position) == ITEM_FOOT){
      if (position == 0){
        ((WeatherListItemFooter)holder.itemView).setPosition(position);
      }
    }
  }
```
- ã€å°çŸ¥è¯†ã€‘**æ¥å£å›è°ƒ** çš„å®è´¨ç®€å•ç‚¹è®²å°±æ˜¯ä¸åŒçš„ç±»åŒæ—¶ä¾èµ–åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„æŸä¸ªæ–¹æ³•åœ¨ä¸€ä¸ªåœ°æ–¹è¢«è°ƒç”¨ï¼Œè‡ªç„¶å°±ä¼šæ‰§è¡Œæ–¹æ³•é‡Œçš„é€»è¾‘ã€‚
è€Œè¿™ä¸ªå¯¹è±¡çš„å…·ä½“é€»è¾‘æ˜¯åœ¨å¦ä¸€ä¸ªç±»é‡Œå†™çš„ï¼Œæ‰€ä»¥å°±ç›¸å½“äºæ‰§è¡Œè¯¥ç±»é‡Œçš„ä»£ç äº†ã€‚è¿™å…¶å®å’Œä½ åˆ›å»ºä¸€ä¸ªAç±»ï¼Œç„¶ååœ¨Bç±»ä¸­å®ä¾‹åŒ–ä¸€ä¸ªAç±»å¯¹è±¡ï¼Œæ¥ç€è°ƒç”¨è¯¥å®ä¾‹çš„æ–¹æ³•ï¼Œå°±ä¼šæ‰§è¡ŒAç±»ä¸­çš„é€»è¾‘æ˜¯ä¸€ä¸ªé“ç†ã€‚  
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠOnItemClickListenerå¯¹è±¡çš„é€»è¾‘ä»¥å†…éƒ¨ç±»çš„å½¢å¼å†™åœ¨MainActivityä¸­ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ä¼ é€’åˆ°Adapterä¸­ï¼Œå†åœ¨Adapterä¸­è°ƒç”¨è¯¥å®ä¾‹çš„onItemClick()æ–¹æ³•ï¼Œå°±ä¼šæ‰§è¡Œå†™åœ¨MainActivityä¸­çš„onItemClick()æ–¹æ³•çš„é€»è¾‘äº†ã€‚    

å¬èµ·æ¥æŒºå±Œçš„HookæŠ€æœ¯å…¶å®ä¹Ÿå°±æ˜¯è¿™ä¸ªç®€å•çš„åŸç†ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨HookæŠ€æœ¯ã€‚é“¾æ¥åœ¨æ­¤ï¼[ã€å…¶å®ç”¨é«˜å¤§ä¸Šçš„HookæŠ€æœ¯åŠ¨æ€æ³¨å…¥ä»£ç å¾ˆç®€å•ï¼Œä¸€çœ‹å°±ä¼šï¼ã€‘http://www.jianshu.com/p/14d6aa8c026d](http://www.jianshu.com/p/14d6aa8c026d)  

---

è¿™é‡Œæˆ‘æŠŠOnItemClickListeneræ¥å£ä»¥é™æ€å†…éƒ¨ç±»çš„å½¢å¼å†™åœ¨Adapterä¸­ã€‚å› ä¸ºè€ƒè™‘åˆ°å®ƒçš„ä¸“ç”¨æ€§æ¯”è¾ƒå¼ºï¼Œåˆ†æ•£å‡ºå»ç»“æ„å°±å¤ªæ•£äº†ã€‚
```
  public void setOnItemClickListener(OnItemClickListener onItemClickListener) {
    this.onItemClickListener = onItemClickListener;
  }

  public static interface OnItemClickListener {
    void onItemClick(View v, int position);
  }
```
å…³äºAdapterå°±è¿™ä¹ˆå¤šï¼Œè¯¦ç»†çš„å†…å®¹å¯ä»¥åˆ°[ã€Githubæºç ã€‘https://github.com/chenBingX/OneWeather/blob/469abd6b78c185d370b5f339ce924d126ca616f7/app/src/main/java/com/chenbing/oneweather/adapters/WeatherListAdapter.java](https://github.com/chenBingX/OneWeather/blob/469abd6b78c185d370b5f339ce924d126ca616f7/app/src/main/java/com/chenbing/oneweather/adapters/WeatherListAdapter.java)æŸ¥çœ‹ã€‚

## ItemView
å¤©æ°”ä¿¡æ¯çš„ItemViewæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ä¸œè¥¿ï¼Œå°±ä¸æäº†ã€‚ä¸»è¦çœ‹ä¸€ä¸‹åº•éƒ¨çš„æœç´¢æ¡†ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-9b7db60c397fbe8b.gif?imageMogr2/auto-orient/strip)  
å…ˆçœ‹ä¸€ä¸‹xmlæ–‡ä»¶ã€‚  
```
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout
  xmlns:android="http://schemas.android.com/apk/res/android"
  android:layout_width="match_parent"
  android:layout_height="wrap_content"
  xmlns:app="http://schemas.android.com/apk/res-auto"
  xmlns:tools="http://schemas.android.com/tools"
  android:background="@color/opacity_3_5_black"
  android:padding="10dp"
  android:id="@+id/root"
  >

  <LinearLayout
    android:id="@+id/search_container"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_alignParentLeft="true"
    android:layout_toLeftOf="@+id/cancel"
    android:layout_below="@+id/header_info"
    android:background="@drawable/shape_weather_list_item_footer_et"
    >

    <!--è¿™æ˜¯æˆ‘è‡ªå®šä¹‰çš„ä¸€ä¸ªæ§ä»¶ï¼Œèƒ½å¤Ÿæ–¹ä¾¿çš„åšå‡ºä¸€äº›æ•ˆæœï¼Œæ¯”å¦‚è¿™ä¸ª
    åœ†è§’æœç´¢å›¾æ ‡-->
  <com.chenbing.oneweather.CustomViews.RoundCornerTextView
    android:layout_width="30dp"
    android:layout_height="match_parent"
    app:state_drawable="@drawable/search"
    app:solid="@color/opacity_3_black"
    app:isShowState="true"
    app:corner="5dp"
    />

  <EditText
    android:id="@+id/search"
    android:layout_width="match_parent"
    android:layout_height="30dp"
    android:textSize="10sp"
    android:textColor="@color/opacity_8_white"
    android:textColorHint="@color/opacity_8_white"
    android:fadingEdge="none"
    android:singleLine="true"
    android:background="@null"
    android:paddingLeft="5dp"
    android:paddingRight="5dp"
    android:textCursorDrawable="@drawable/shape_et_cursor"
    />
  </LinearLayout>

  <!--æˆ‘å¯¹TextViewéƒ½è¿›è¡Œäº†ä¸€ä¸‹åŒ…è£…ï¼Œæ–¹ä¾¿ä»¥åæ‰©å±•ä¿®æ”¹-->
  <com.chenbing.oneweather.CustomViews.TextView.NormalTextView
    android:id="@+id/cancel"
    android:layout_width="wrap_content"
    android:layout_height="30dp"
    android:text="@string/cancel"
    android:textSize="14sp"
    android:gravity="center"
    android:layout_alignParentRight="true"
    android:layout_below="@+id/header_info"
    android:layout_marginLeft="8dp"
    android:textColor="@color/opacity_8_white"
    />

  <android.support.v7.widget.RecyclerView
    android:id="@+id/city_list"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_below="@+id/search_container"
    tools:listitem="@layout/item_text_view"
    android:padding="10dp"
    android:overScrollMode="never"
    android:scrollbars="none"
    android:visibility="gone"
    />

  <com.chenbing.oneweather.CustomViews.TextView.NormalTextView
    android:id="@+id/not_found"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_below="@+id/search_container"
    android:padding="5dp"
    android:text="@string/search_not_found"
    android:textColor="@color/opacity_5_white"
    android:layout_margin="10dp"
    android:visibility="gone"
    />

  <com.chenbing.oneweather.CustomViews.TextView.NormalTextView
    android:id="@+id/header_info"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:text="@string/weather_list_footer_title"
    android:gravity="center"
    android:textSize="14sp"
    android:textColor="@color/opacity_8_white"
    android:layout_alignParentTop="true"
    android:layout_alignParentStart="true"
    android:layout_marginBottom="5dp"
    />


</RelativeLayout>
```
[ã€Githubæºç ã€‘https://github.com/chenBingX/OneWeather/blob/master/app/src/main/res/layout/item_weather_list_footer.xml](https://github.com/chenBingX/OneWeather/blob/master/app/src/main/res/layout/item_weather_list_footer.xml)  
è¿™ä¸ªxmlå¸ƒå±€å·²ç»è¶³å¤Ÿè®©UIç•Œé¢å±•ç¤ºå‡ºæ¥äº†ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘æŠŠæ ¹å¸ƒå±€è®¾ç½®æˆäº†wrap_contentï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªRecyclerViewï¼Œå°±æ˜¯å±•ç¤ºæœç´¢ç»“æœçš„åˆ—è¡¨ï¼Œå®ƒçš„é«˜åº¦æ˜¯ä¸ç¡®å®šçš„ã€‚  
  
- å…³äºRoundCornerTextViewå¯ä»¥çœ‹è¿™é‡Œ[ã€éœ‡æƒŠï¼è¿™ä¸ªæ§ä»¶ç»å¯¹å€¼å¾—æ”¶è—ã€‚è½»æ¾å®ç°åœ†è§’ã€æ–‡å­—æè¾¹ã€çŠ¶æ€æŒ‡ç¤ºç­‰æ•ˆæœã€‘http://www.jianshu.com/p/cfe18cbc6924](http://www.jianshu.com/p/cfe18cbc6924)

- ã€å°çŸ¥è¯†ã€‘android:background="@drawable/shape_weather_list_item_footer_et"ä¸­ä½¿ç”¨äº†ä¸€ä¸ªshapeæ¥å®ç°åœ†è§’èƒŒæ™¯ã€‚

```
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
  android:shape="rectangle"  //è¿™é‡ŒæŒ‡å®šåŸºç¡€çš„shape
  >
  <corners android:radius="5dp"/> //è¿™ä¸ªå‚æ•°æ§åˆ¶åœ†è§’å¤§å°
  <solid android:color="@color/opacity_5_black"/>  //è¿™ä¸ªå‚æ•°æ§åˆ¶shapeçš„é¢œè‰²ã€‚

</shape>
```

Shapeåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥Googleä¸€ä¸‹èƒ½å¤Ÿæ‰¾åˆ°å¤§é‡çš„èµ„æ–™ã€‚ç°åœ¨æˆ‘ä¹Ÿä¼šä½¿ç”¨RoundCornerTextViewæ¥ä»£æ›¿Shapeï¼Œå®ç°å„ç§å„æ ·çš„èƒŒæ™¯æ•ˆæœï¼Œè¿™ç§æ–¹å¼æ›´å®¹æ˜“è¿›è¡Œæ”¹å˜å’Œæ‰©å±•ã€‚
  
 è¿™ä¸ªWeatherListItemFooterè™½ç„¶æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ§ä»¶ï¼Œä½†å®ƒéœ€è¦å¤„ç†ç¨å¤æ‚çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ä¾èµ–ä¸€ä¸ªPresenteræ¥è§£è€¦é€»è¾‘ã€‚å°±åƒActivityå’ŒFragmenté‚£æ ·ï¼Œä½¿ç”¨MVPç»“æ„ã€‚è¿™ä¸ªItemä¸­æœ€é‡è¦çš„å†…å®¹å°±æ˜¯å¤„ç†æœç´¢äº†ã€‚  

å…ˆçœ‹çœ‹å®ƒçš„Presenteræ¨¡å—çš„ä»£ç ã€‚
```
//åŒæ ·å…ˆå®šä¹‰æ¥å£
public interface WeatherListItemFooterPresenterApi extends BasePresenter {

  //æœç´¢åŒ¹é…åŸå¸‚
  void matchCity(String content);
}

//å®ç°ç±»
public class WeatherListItemFooterPresenter
    implements
      WeatherListItemFooterPresenterApi,
      CityListModel.OnMatchedListener {
  //ä¾èµ–æŠ½è±¡
  private WeatherListItemFooterView view;
  private CityListModelApi model;

  public WeatherListItemFooterPresenter(WeatherListItemFooter view) {
    this.view = view;
    this.model = new CityListModel(); //å®ä¾‹åŒ–ä¸€ä¸ªModelï¼Œä¸‹é¢å†çœ‹Modelæ¨¡å—
    model.setOnMatchedListener(this); //è®¾ç½®ç›‘å¬å™¨ï¼Œä»¥è·å–æœç´¢åŒ¹é…çš„ç»“æœ
  }

  @Override
  public void matchCity(String content) {
    model.matchCity(content); //è®©Modelå¼€å§‹æœç´¢åŒ¹é…
  }

  @Override
  public void onMatched(List<String> cities) {
    view.onMatched(cities);  //è®©Viewæ›´æ–°æ•°æ®
  }

  @Override
  public void destroy() {
    model = null;
    view = null;
  }
}
```

Modelæ¨¡å—ã€‚
```
//å…ˆå®šä¹‰æ¥å£
public interface CityListModelApi {

  void matchCity(String content); //åŒ¹é…åŸå¸‚

  void setOnMatchedListener(CityListModel.OnMatchedListener onMatchedListener); //è®¾ç½®ç›‘å¬
}

//å®ç°ã€‚ä¸»è¦å°±æ˜¯è¯»å–åŸå¸‚åˆ—è¡¨æ–‡ä»¶ï¼Œç„¶ååŒ¹é…ã€‚å½“ç„¶è¯»å–ä¸€æ¬¡ä¹‹åå°±ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå› ä¸ºå®ƒçš„ä½¿ç”¨é¢‘ç‡æ¯”è¾ƒé«˜çš„ã€‚
public class CityListModel implements CityListModelApi {

  private OnMatchedListener onMatchedListener; 

  @Override
  public void matchCity(String content) {
    //ä½¿ç”¨RxJavaæ¥å®ç°
    Observable.create(new Observable.OnSubscribe<List<City>>() {
      @Override
      public void call(Subscriber<? super List<City>> subscriber) {
      //è·å–åŸå¸‚åˆ—è¡¨ã€‚å†…å­˜æœ‰å°±ç›´æ¥å–ï¼Œå¦åˆ™ä»Assetsè¯»å–ã€‚
        List<City> cityList = getCityList(); 
        subscriber.onNext(cityList);
        subscriber.onCompleted();
      }
    })
        //å˜æ¢çº¿ç¨‹
      .subscribeOn(Schedulers.io()) 
      .observeOn(AndroidSchedulers.mainThread())
        .subscribe(new Subscriber<List<City>>() {
          @Override
          public void onCompleted() {}

          @Override
          public void onError(Throwable e) {
            e.printStackTrace();
          }

          @Override
          public void onNext(List<City> cityList) {
            match(cityList, content);  //åŒ¹é…
          }
      });
  }

  private List<City> getCityList() {
    List<City> cityList = DataCache.getInstance().get(DataCache.Key.CITY_LIST, ArrayList.class);
    if (cityList == null) {
      cityList = getCityListFromAssets();
    }
    return cityList;
  }

  private List<City> getCityListFromAssets() {
    InputStream inputStream = null;
    try {
      List<City> cityList;
      //æ‰“å¼€è¯»å–Assetsæ–‡ä»¶çš„é€šé“
      inputStream = ChiceApplication.getAppContext().getAssets().open("CityArray.JSON");
      int size = inputStream.available();
      byte[] bytes = new byte[size];
      inputStream.read(bytes);
      inputStream.close();

      String string = new String(bytes);
      Type type = new TypeToken<List<City>>() {}.getType();
      cityList = GsonUtils.getSingleInstance().fromJson(string, type);

      //ç¼“å­˜ï¼Œä¸‹æ¬¡å°±ä¸ç”¨å†è¯»äº†
      DataCache.getInstance().add(DataCache.Key.CITY_LIST, cityList);
      return cityList;

    } catch (IOException e) {
      e.printStackTrace();
      if (inputStream != null) {
        try {
          inputStream.close();
        } catch (IOException e1) {
          e1.printStackTrace();
        }
      }
      return Collections.emptyList();
    }
  }

  private void match(final List<City> cityList, final String content) {
    Observable.create(new Observable.OnSubscribe<List<String>>() {
      @Override
      public void call(Subscriber<? super List<String>> subscriber) {
        //
        List<String> result = matchAndReturnResult(cityList, content);
        subscriber.onNext(result);
        subscriber.onCompleted();
      }
    })
        .subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread())
        .subscribe(new Subscriber<List<String>>() {
          @Override
          public void onCompleted() {
          }

          @Override
          public void onError(Throwable e) {
          }

          @Override
          public void onNext(List<String> result) {
            if (onMatchedListener != null) {
              //å›è°ƒç»“æœ
              onMatchedListener.onMatched(result);
            }
          }
        });
  }

  @NonNull
  private List<String> matchAndReturnResult(List<City> cityList, String content) {
    List<String> result = new ArrayList<>();
    for (City city : cityList) {
      String cityName = city.getAreaname();
      if (cityName.contains(content)) {
        result.add(cityName);
      }
    }
    return result;
  }

  @Override
  public void setOnMatchedListener(OnMatchedListener onMatchedListener) {
    this.onMatchedListener = onMatchedListener;
  }

  //å› ä¸ºæ˜¯ä¸“é—¨çš„ç›‘å¬ï¼Œæ‰€ä»¥å†™åœ¨è¯¥ç±»ä¸­å°±å¥½ã€‚
  public static interface OnMatchedListener {
    void onMatched(List<String> cities);
  }
}
```

ç°åœ¨åœ¨Viewæ¨¡å—WeatherListItemFooterä¸­å·²ç»èƒ½è·å–åˆ°åŒ¹é…æ•°æ®äº†ã€‚å±•ç¤ºæ•°æ®å°±æ˜¯RecyclerViewï¼Œå°±ä¸å†å¤šè¯´äº†ã€‚
- ã€å°çŸ¥è¯†ã€‘è¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹å…³é”®å­—å˜ç™½çš„å®ç°ã€‚è¿™é‡Œä½¿ç”¨äº†SpannableStringåœ¨Adapterä¸­æ¥å®ç°ã€‚
```
private void setItemViewData(RecyclerView.ViewHolder holder, int position) {
    if (!TextUtils.isEmpty(matchContent)){
      //åˆ›å»ºä¸€ä¸ªSpannableString
      SpannableString ss = new SpannableString(datas.get(position));
      //è·å–å…³é”®å­—çš„ä½ç½®
      int index = datas.get(position).indexOf(matchContent);
      //è·å–å…³é”®å­—çš„é•¿åº¦
      int length = matchContent.length();
      //å°†å…³é”®å­—éƒ¨åˆ†è®¾ç½®ä¸ºç™½è‰²
      ss.setSpan(new ForegroundColorSpan(Color.WHITE), index, index + length,
        Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
      //è®¾ç½®æ–‡å­—
      ((TextView) (holder.itemView)).setText(ss);
    } else {
      ((TextView) (holder.itemView)).setText(datas.get(position));
    }
  }
```

å¯ä»¥çœ‹åˆ°SpannableStringçš„ä½¿ç”¨ååˆ†ç®€å•ï¼Œä½†å®ç°çš„æ•ˆæœå¯ä¸ç®€å•ã€‚å®ƒè¿˜èƒ½å®ç°å›¾ç‰‡æ’å…¥ç­‰è¯¸å¤šæ•ˆæœã€‚æƒ³è¦è¯¦ç»†äº†è§£çš„åŒå­¦å¯ä»¥å‚è€ƒä¸‹è¿™ä¸ªé“¾æ¥ï¼š[ã€androidä¸­ç”¨Spannableåœ¨TextViewä¸­è®¾ç½®è¶…é“¾æ¥ã€é¢œè‰²ã€å­—ä½“ã€‘http://aichixihongshi.iteye.com/blog/1207503](http://aichixihongshi.iteye.com/blog/1207503)

---
åŸå¸‚åŒ¹é…åˆ—è¡¨çš„æ¡ç›®çš„ç‚¹å‡»äº‹ä»¶æˆ‘æŠŠå®ƒç”¨æ¥å£å›è°ƒçš„æ–¹å¼ä¼ é€’åˆ°WeatherListItemFooterè¿›è¡Œå¤„ç†ï¼Œå› ä¸ºç‚¹å‡»åéœ€è¦WeatherListItemFooterä¸­çš„UIè¿›è¡Œç›¸åº”çš„å˜åŒ–ã€‚
```
cityListAdapter.setOnItemClickListener((v, cityName) -> {
      if (!TextUtils.isEmpty(cityName)){
        CityNameEvent cityNameEvent = new CityNameEvent();
        cityNameEvent.cityName = cityName;
        //ä½¿ç”¨RxBuså‘é€é€‰ä¸­çš„åå­—åˆ°MainActivityPresenterè¿›è¡Œå¤„ç†
        RxBus.get().post(cityNameEvent);  
        //éœ€è¦é‡ç½®ä¸€ä¸‹æœç´¢æ¡†
        clearSearch(); 
      }
    });
```

MainActivityPresenteræ¥æ”¶åˆ°CityNameEvent
```
private void addCityWeatherRxBus() {
    //æ³¨å†Œä¸€ä¸‹äº‹ä»¶ã€‚å°±åƒä½¿ç”¨EventBusä¸€æ ·ã€‚
    RxBus.get().register(this, CityNameEvent.class).subscribe(new Subscriber<CityNameEvent>() {
      @Override
      public void onCompleted() {

      }

      @Override
      public void onError(Throwable e) {
        e.printStackTrace();
      }

      @Override
      public void onNext(CityNameEvent cityNameEvent) {
        String cityName = cityNameEvent.cityName;
        if(view != null){
          LogUtils.e("cityName = " + cityName);
          view.addCityPage(cityName); //æ·»åŠ ä¸€é¡µæ–°çš„å¤©æ°”ä¿¡æ¯
        }
      }
    });

  }
```

[ã€CityListAdapteræºç Githubã€‘https://github.com/chenBingX/OneWeather/blob/5dc31236db48b1525d96d5b1e0f388aa9e0b3aa9/app/src/main/java/com/chenbing/oneweather/adapters/CityListAdapter.java](https://github.com/chenBingX/OneWeather/blob/5dc31236db48b1525d96d5b1e0f388aa9e0b3aa9/app/src/main/java/com/chenbing/oneweather/adapters/CityListAdapter.java)  

**RxBusåŸºäºRxJavaï¼Œæ˜¯æˆ‘ç”¨æ¥æ›¿ä»£EventBusçš„ï¼Œè¿™æ ·å¯ä»¥å°‘ä¾èµ–ä¸€ä¸ªåº“ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå·±æ¥æ§åˆ¶å®ç°ç»†èŠ‚ã€‚å¯èƒ½è¿˜æœ‰é—®é¢˜ï¼Œä½†æš‚æ—¶æ²¡å‘ç°ï¼Œæ‰€ä»¥ç°åœ¨RxBusèƒ½å·¥ä½œçš„å¾ˆå¥½ï¼Œå³ä½¿æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ã€‚å¦‚æœä½ æƒ³è¦äº†è§£å®ƒå®ç°å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„æºç ï¼š[ã€RxBusæºç Githubã€‘https://github.com/chenBingX/OneWeather/blob/469abd6b78c185d370b5f339ce924d126ca616f7/app/src/main/java/com/chenbing/oneweather/Utils/RxBus.java](https://github.com/chenBingX/OneWeather/blob/469abd6b78c185d370b5f339ce924d126ca616f7/app/src/main/java/com/chenbing/oneweather/Utils/RxBus.java)**  

æˆ‘ä»¬åœ¨çœ‹ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯é‡ç½®æœç´¢æ¡†ã€‚
```
private void clearSearch() {
    etSearch.setText("");
    
    //æ¸…é™¤ç„¦ç‚¹ã€‚åé¢ä¼šè¯¦ç»†è¯´ä¸€ä¸‹ã€‚
    etSearch.clearFocus(); 
    tvCancel.setFocusableInTouchMode(true);
    tvCancel.requestFocus();

    AppUtils.hideInputMethod(etSearch); //éšè—è¾“å…¥æ³•ï¼Œå¦åˆ™UIå¾ˆéš¾å—ã€‚

    rvCityList.setVisibility(GONE);
    tvNotFound.setVisibility(GONE);
  }
```

- ã€å°çŸ¥è¯†ã€‘æ¸…é™¤æœç´¢æ¡†çš„ç„¦ç‚¹ã€‚Viewæä¾›äº†ä¸€ä¸ªclearFocus()æ–¹æ³•æ¥æ¸…é™¤ç„¦ç‚¹ã€‚ä½†æ˜¯æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ï¼Œä½ çš„è°ƒç”¨æ˜¯æ— æ•ˆï¼æ˜¯ä¸æ˜¯åœ¨æ€€ç–‘äººç”Ÿï¼Ÿè¯´å¥½çš„æ¸…é™¤å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ²¡æ•ˆæœï¼å…¶å®å½“æˆ‘ä»¬è°ƒç”¨clearFocus()åç„¦ç‚¹ç¡®å®è¢«æ¸…é™¤äº†ï¼Œä½†æ˜¯Androidéœ€è¦ç«‹å³æŠŠç„¦ç‚¹ç§»åˆ°ä¸‹ä¸€ä¸ªå¯è·å¾—ç„¦ç‚¹çš„æ§ä»¶ä¸Šã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£è‡ªç„¶åˆå›åˆ°åŸæ§ä»¶ä¸Šã€‚æ‰€ä»¥æˆ‘åé¢è®©å–æ¶ˆæŒ‰é’®å˜å¾—å¯ä»¥è·å¾—ç„¦ç‚¹ï¼Œå¹¶æŠŠç„¦ç‚¹ç§»åŠ¨åˆ°å®ƒä¸Šé¢ã€‚
- ã€å°çŸ¥è¯†ã€‘è¾“å…¥æ³•çš„æ˜¾ç¤ºï¼éšè—
```
public static void showInputMethod(View view) {
    try {
      //è·å¾—è¾“å…¥æ³•ç®¡ç†å™¨
      InputMethodManager imm = (InputMethodManager) view.getContext()
          .getSystemService(Context.INPUT_METHOD_SERVICE);
          //æ˜¾ç¤ºè¾“å…¥æ³•ï¼Œéœ€è¦æŒ‡å®šåŸºäºé‚£ä¸ªViewæ˜¾ç¤ºã€‚ä¼šå½±å“è¾“å…¥æ³•å¼¹èµ·åå¯¹UIçš„å½±å“ã€‚
      imm.showSoftInput(view, InputMethodManager.SHOW_FORCED); 
    } catch (Exception e) {
      e.printStackTrace();
    }
  }

  public static void hideInputMethod(View view) {
    if (view != null && view.getContext() != null && view.getWindowToken() != null) {
      try {
        ((InputMethodManager) view.getContext().getSystemService(Context.INPUT_METHOD_SERVICE))
        //éšè—è¾“å…¥æ³•ï¼Œéœ€è¦æä¾›å…¶æ‰€åœ¨çª—å£çš„Tokenã€‚
            .hideSoftInputFromWindow(view.getWindowToken(), 0); 
      } catch (Exception e) {
        e.printStackTrace();
      }
    }
  }
```

# æ€»ç»“
æœ¬ç¯‡ä¸»è¦ä»‹ç»äº†**ã€ŠOne Weatherã€‹**è¿™æ¬¾å…¥é—¨çº§Appçš„ç®€è¦å¤©æ°”åˆ—è¡¨åŠå…¶ä¸­åŒ…å«çš„æœç´¢æ¡†çš„å®ç°ã€‚æˆ‘ä»…æŠ½å–äº†ä¸€äº›è®¤ä¸ºéœ€è¦è¯´ä¸€ä¸‹çš„åœ°æ–¹å†™äº†ï¼Œå¹¶ä¸”ä¸€äº›æ¶‰åŠåˆ°çš„çŸ¥è¯†æˆ‘ç”¨ã€å°çŸ¥è¯†ã€‘è¿™æ ·çš„æ ‡è¯†è¡¨äº†å‡ºæ¥ã€‚å¸Œæœ›èƒ½è®©å¤§å®¶çš„é˜…è¯»æ›´æ˜“è¿›è¡Œã€‚å½“ç„¶ï¼Œå¾ˆå¤šå…·ä½“çš„å®ç°ç»†èŠ‚è¿˜éœ€è¦å¤§å®¶åˆ°Githubä¸Šçœ‹ã€‚ä¸‹é¢æ˜¯é¡¹ç›®åœ°å€ï¼š  

## [ã€é¡¹ç›®åœ°å€Githubã€‘https://github.com/chenBingX/OneWeather](https://github.com/chenBingX/OneWeather)  

### æœ€åå¦‚æœä½ è§‰å¾—è¿˜ä¸é”™ï¼Œè®°å¾—åŠ ä¸ªå…³æ³¨ã€ç‚¹ä¸ªèµå“¦ï¼ä½ çš„é¼“åŠ±æ˜¯æˆ‘æœ€å¤§åŠ¨åŠ›ï¼
### å¦‚æœå¯¹è¿™ä¸ªé¡¹ç›®æ„Ÿå…´è¶£ï¼Œè¯·æ‰“å¼€Githubé¡¹ç›®åœ°å€é“¾æ¥ï¼Œå…³æ³¨ä¸€ä¸‹ç‚¹ä¸ªèµã€‚éšæ—¶è·å–è¯¥é¡¹ç›®çš„æœ€æ–°åŠ¨æ€ã€‚
