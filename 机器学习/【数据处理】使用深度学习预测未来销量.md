![image](http://upload-images.jianshu.io/upload_images/1869462-7aaa90d2b93926d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


åœ¨[ ã€Šã€Getã€‘ç”¨æ·±åº¦å­¦ä¹ è¯†åˆ«æ‰‹å†™æ•°å­—ã€‹ ](https://www.jianshu.com/p/ab68c7ba964b) ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ‰‹å†™æ•°å­—è¯†åˆ«çš„ä¾‹å­ï¼Œä½“éªŒäº†å¦‚ä½•ä½¿ç”¨ **æ·±åº¦å­¦ä¹  + tensorflow** è§£å†³ä¸€ä¸ªå…·ä½“çš„é—®é¢˜ã€‚  

å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼Œå³å°†è¾“å…¥çš„å›¾ç‰‡æ•°æ®åˆ†æˆ 0-9 å…± 10 ä¸ªç±»åˆ«ï¼Œè€Œä¸”æˆ‘ä»¬çš„æ•°æ®éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ MNIST ä¸Šä¸‹è½½çš„å¤„ç†å¥½çš„æ•°æ®ã€‚  

åœ¨ç°å®ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®æºé€šå¸¸æ¥è‡ªäºæ•°æ®åº“ï¼Œæ˜¯æ²¡æœ‰ç»è¿‡é¢„å¤„ç†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥åšäº›ä»€ä¹ˆæ¥è®©è¿™äº›æ•°æ®åº“é‡Œçš„æ•°æ®èƒ½å¤Ÿç”¨äºè¿›è¡Œæœºå™¨å­¦ä¹ å‘¢ï¼Ÿ  

æœºå™¨å­¦ä¹ çš„å‰ç½®æ­¥éª¤ï¼Œæ•°æ®é¢„å¤„ç†å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚  

æœ¬ç¯‡ CoorChice å°†ä¼šé€šè¿‡ä¸€ä¸ªå›å½’é¢„æµ‹é—®é¢˜ï¼Œæ¥å±•ç¤ºå¦‚ä½•è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚  

# åŸå§‹æ•°æ®

æˆ‘ä»¬ç”¨äºæœºå™¨å­¦ä¹ çš„æ•°æ®çš„é‡ä¸èƒ½å¤ªå°‘ï¼Œå¦åˆ™è®­ç»ƒæ•ˆæœä¼šæå·®ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸ªäººå¦‚ä½•æ‰èƒ½è·å–åˆ°å¤§é‡çš„æ•°æ®æ¥è¿›è¡Œè®­ç»ƒå‘¢ï¼Ÿ  

CoorChice æ¨è [kaggleï¼šhttps://www.kaggle.com/datasets](https://www.kaggle.com/datasets)ï¼Œè¿™æ˜¯å…¨çƒæœ€å¤§çš„æ•°æ®ç§‘å­¦ç¤¾åŒºå’Œæ•°æ®ç«èµ›å¹³å°ã€‚åœ¨è¿™ä¸ªç¾å¦™çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„æ‰¾åˆ°å„ç§å„æ ·çš„ï¼Œæµ·é‡çš„ï¼Œç²¾å½©ç»ä¼¦çš„æ•°æ®ã€‚ 

![image](http://upload-images.jianshu.io/upload_images/1869462-3c786858a09368fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ‰“å¼€é“¾æ¥å°±å¯ä»¥çœ‹åˆ°æµ·é‡çš„æ•°æ®ï¼Œæˆ‘ä»¬å¾ˆéšæ„çš„é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ•°æ®æºæ¥è¿›è¡Œè®­ç»ƒã€‚  

**å°±é€‰ç¬¬ä¸€æ¡å§ï¼**  

ç¬¬ä¸€æ¡æ•°æ®æ˜¯å…³äºä¸€ä¸ªé¢åŒ…åº—çš„äº¤æ˜“çš„æ•°æ®ã€‚ç‚¹å‡»è¿›å…¥åï¼Œæ‰¾åˆ°ä¸‹è½½å°±å¯ä»¥ä¸‹è½½è¿™å¥—æ•°æ®äº†ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-c01759709d09442b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

ä¹Ÿè®¸ä½ å¯èƒ½ä¸èƒ½ç«‹åˆ»ä¸‹è½½ï¼Œå› ä¸ºä»–ä¼šè¦æ±‚ä½ å…ˆç™»å½•ã€‚é‚£å°±æˆä¸º Kaggle çš„ä¼šå‘˜å§ã€‚  

æˆ‘ä»¬ä½¿ç”¨è¡¨æ ¼æ‰“å¼€åˆšåˆšä¸‹è½½çš„æ•°æ®è§‚å¯Ÿè§‚å¯Ÿã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-e04e495d94b3798b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

**My Godï¼** è¿™æ˜¯ä¸€å †ç®€é™‹ä¸å ªçš„æ•°æ®ï¼Œå…±æœ‰ 21293 æ¡æ•°æ®ï¼Œæ¯æ¡åªæœ‰ 4 ä¸ªç‰¹å¾ï¼ 4 ä¸ªç‰¹å¾ï¼ 4 ä¸ªç‰¹å¾ï¼  

æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åªæ˜¯å­¦ä¹ å¦‚ä½•å¤„ç†æ•°æ®çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å°±å‡‘åˆç€ç”¨ä¸€ä¸‹å§ã€‚  

# å¼€å§‹æ•°æ®å¤„ç†

å®é™…ä¸Šï¼Œé€šå¸¸æˆ‘ä»¬çš„æ•°æ®å‘†åœ¨æ•°æ®åº“ä¸­ï¼Œå°±æ˜¯è¿™ç§è¡¨æ ¼çš„å½¢å¼ã€‚  

åœ¨å¼€å§‹ä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£…ä¸€ä¸‹ Pandas è¿™ä¸ª Python åº“ï¼Œå®ƒè¢«ç”¨æ¥è¯»å–æˆ‘ä»¬çš„è¡¨æ ¼æ•°æ®ï¼Œå’Œè¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ“ä½œã€‚  

ä¸‹å¥½äº†ï¼Œæˆ‘ä»¬å°±å¼€å§‹å§...

## è§‚å¯Ÿæ•°æ®

è¿›è¡Œæ•°æ®å¤„ç†æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œè§‚å¯Ÿå’Œåˆ†æã€‚é€šè¿‡è§‚å¯Ÿå’Œåˆ†æï¼Œæˆ‘ä»¬è¦é™¤å»ä¸€äº›æ— å…³ç´§è¦çš„æ•°æ®åˆ—ï¼Œæ¯”å¦‚åœ¨é¢„æµ‹å¤©æ°”é¢„æŠ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±åº”è¯¥æŠŠ â€˜æé›·æ—©ä¸Šåƒäº†ä»€ä¹ˆâ€™ è¿™ä¸ªæ•°æ®åˆ—å»æ‰ï¼Œå› ä¸ºå¯¹æ¨¡å‹è®­ç»ƒæ¯«æ— å¸®åŠ©ã€‚   

åŒæ—¶ï¼Œæˆ‘ä»¬è¦ä»æ•°æ®ä¸­æŒ–æ˜å‡ºä¸€äº›éšè—çš„ä¿¡æ¯ï¼Œä»¥æ‰©å……ç‰¹å¾ã€‚æ—¥å…¥åœ¨é¢„æµ‹äº§å“çš„äº¤æ˜“ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬ä»æ—¥æœŸè¿™ä¸ªæ•°æ®åˆ—ï¼Œå°±èƒ½çŸ¥é“å½“å¤©æ˜¯å¦æ˜¯ä¸€ä¸ªèŠ‚æ—¥ï¼Œæ˜¯ä»€ä¹ˆèŠ‚æ—¥ã€‚ 

åœ¨æˆ‘ä»¬ä¸‹è½½çš„è¿™å †é¢åŒ…åº—çš„äº¤æ˜“æ•°æ®ä¸­ï¼Œä»…æœ‰æƒ¨ä¸å¿ç¹çš„ 4 ä¸ªç±»ç›®ï¼  

é€šå¸¸ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥è§£å†³é—®é¢˜æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç›®çš„ã€‚æ¯”å¦‚ï¼Œåœ¨è¿™å †æ•°æ®ä¸­ï¼ŒCoorChice å¸Œæœ›é€šè¿‡æœºå™¨å­¦ä¹ è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œèƒ½å¤Ÿç”¨äºé¢„æµ‹æœªæ¥ä¸€å®šæ¡ä»¶ä¸‹çš„æŸç§ç±»å‹çš„é¢åŒ…æ‰€èƒ½è¾¾åˆ°çš„äº¤æ˜“é‡æ˜¯å¤šå°‘ã€‚  

å› æ­¤ï¼Œæˆ‘ä»¬å°†äº¤æ˜“é‡ Transaction è¿™ä¸€åˆ—æ•°æ®ä½œä¸ºæ•°æ®é›†çš„æ ‡ç­¾æ•°æ®ã€‚  

æ¥ä¸‹æ¥å‰©ä¸‹çš„åªæœ‰ `æ—¥æœŸã€æ—¶é—´ã€é¢åŒ…ç±»ç›®` è¿™ä¸‰ä¸ªç‰¹å¾äº†ã€‚  

## ä»æ•°æ®ä¸­æŒ–æ˜æ›´å¤šçš„ä¿¡æ¯

ä»…æœ‰è¿™ä¸‰ä¸ªç‰¹å¾æ¥è¿›è¡Œè®­ç»ƒï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ä¼šæœ‰å¤šå·®ã€‚æ¯”ä½ æƒ³çš„å·®è¿˜è¦å·®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»ç°æœ‰çš„æ•°æ®ä¸­æŒ–æ˜å‡ºæ›´å¤šçš„ä¿¡æ¯æ¥ã€‚æ¯”å¦‚ï¼Œåœ¨å›¾ç‰‡æ•°æ®ä¸­ï¼Œé€šå¸¸ä¼šè¿›è¡Œä¸€äº›æ—‹è½¬ã€å¹³ç§»ä¹‹ç±»çš„æ“ä½œï¼Œæ¥è¡¥å……æ•°æ®é‡ã€‚  


### æ—¥æœŸ Date
é¦–å…ˆçœ‹çœ‹æ—¥æœŸèƒ½æŒ–æ˜åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Ÿ  

1. å½“ç„¶æ˜¯æ˜ŸæœŸå•¦ã€‚ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€ã€æ˜ŸæœŸäºŒã€...ã€å¯¹äº¤æ˜“è‚¯å®šæ˜¯æœ‰å½±å“çš„ã€‚æˆ‘ä»¬é€šè¿‡ Date å¯ä»¥è®¡ç®—å‡ºå½“å‰æ—¥æœŸæ˜¯å‘¨å‡ ã€‚  

2. è¿˜æœ‰ä»€ä¹ˆå¯æŒ–æ˜çš„å—ï¼Ÿå—¯ï¼Œå·¦æ€å³æƒ³...å’¦ï¼ŒèŠ‚æ—¥è‚¯å®šä¹Ÿæ˜¯å½±å“é¢åŒ…äº¤æ˜“é‡çš„ä¸€ä¸ªé‡è¦å› ç´ ï¼Œæœ‰äº† Date æˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“å½“å‰æ—¥æœŸæ˜¯ä»€ä¹ˆèŠ‚æ—¥ã€‚  

3. ç„¶åï¼Œé€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œéšç€æ—¥æœŸçš„å¢åŠ ï¼Œäº¤æ˜“é‡ä¹Ÿæ˜¯åœ¨ç´¯åŠ çš„ï¼Œæ‰€ä»¥æ—¥æœŸçš„å¤§å°ä¹Ÿå¯ç›´æ¥ä½œä¸ºä¸€ä¸ªç‰¹å¾ã€‚  

4. ç”±äº CoorChice è¦å°è¯•é¢„æµ‹çš„æ˜¯æœªæ¥æŸä¸ªæ—¶é—´ã€æŸç§é¢åŒ…æ‰€èƒ½è¾¾åˆ°çš„äº¤æ˜“é‡ï¼Œæ‰€ä»¥æ—¥æœŸçš„å¤§å°å¯¹ç»“æœå¿…ç„¶æ˜¯æœ‰å½±å“çš„ã€‚ä½†æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†æ—¥æœŸè½¬æ¢ä¸ºä¸€ä¸ªå½¢å¦‚ `20161030` è¿™æ ·çš„æ•°å­—ï¼Œå› ä¸ºä¸€å¹´åªæœ‰ 12 ä¸ªæœˆï¼Œæ¯ä¸€ä¸ªæœˆå¤©æ•°ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°å€¼è·³è·ƒåº¦æ¯”è¾ƒå¤§ï¼Œè¿™æ ·å°±å¤§å¤§å¢åŠ äº†è®­ç»ƒçš„éš¾åº¦å’Œå‡†ç¡®ç‡ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªç»Ÿä¸€æ ‡å‡†çš„æ•°å€¼ã€‚å¦‚æœç¡®å®šæŸä¸€å¤©ä¸ºåŸºå‡†ï¼Œç„¶åæŠŠæ—¥æœŸè½¬æ¢ä¸ºå’Œè¿™ä¸€å¤©çš„è·ç¦»ï¼Œé‚£é‡åŒ–æ ‡å‡†è‡ªç„¶å°±æ˜¯å¾ˆæ˜äº†çš„äº†ã€‚å› ä¸ºæ•°æ®æ˜¯ä» `2016-10-30` å¼€å§‹ï¼Œé‚£ä¹ˆæŠŠè¿™å¤©ä½œä¸ºåŸºå‡†æ—¥å°±å†åˆé€‚ä¸è¿‡äº†ã€‚

### æ—¶é—´ Time 
æ¥ä¸‹æ¥è§‚å¯Ÿ Time æœ‰ä»€ä¹ˆå¯ç”¨çš„æ²¡ã€‚  

1. Time æœ¬èº«æ˜¯ä¸€äº›æ¯”è¾ƒå¯†é›†çš„æ•°æ®ï¼Œé—´éš”ä¸å¤§ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ’å½’åˆ°å°æ—¶é‡Œï¼Œå› æ­¤å°±ä¼šæœ‰ 24 ä¸ªå°æ—¶ã€‚æ¯”å¦‚ï¼Œâ€œ10:13:03â€ å°±è®©å®ƒå±äº 10 ç‚¹è¿™ä¸ªå°æ—¶å§ã€‚  

2. é€šè¿‡æ—¶é—´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çŸ¥é“ç°åœ¨æ˜¯å¤„äº `æ—©æ™¨ã€ä¸Šåˆã€ä¸­åˆã€ä¸‹åˆã€å‚æ™šã€æ™šä¸Šã€æ·±å¤œ` ä¸­çš„é‚£ä¸ªæ—¶é—´æ®µã€‚ä¸åŒçš„æ—¶é—´æ®µæˆ–å¤šæˆ–å°‘ä¹Ÿä¼šå½±å“äº¤æ˜“é‡ã€‚  
 

ç¡®å®šå¥½äº†æ€è·¯ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹æ‰¾ç€è¿™ä¸ªæ€è·¯å¤„ç†æ•°æ®äº†ã€‚ 

## å¤„ç†åŸå§‹æ•°æ®
 
å¤„ç†æ•°æ®çš„ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å…ˆè¯»å–æ•°æ®å•¦ï¼Œæˆ‘ä»¬å‰é¢ä¸‹è½½çš„ Pandas å°±ä½¿ç”¨æ¥å¹²è¿™ä¸ªçš„ã€‚

### è¯»å–æ•°æ®
```
# è¯»å–æ•°æ®
datas = pd.read_csv('data/BreadBasket_DMS.csv')
```

è¯»å–æ•°æ®åï¼Œè¾“å‡ºä¸€ä¸‹çœ‹çœ‹é•¿ä»€ä¹ˆæ ·å­ã€‚  

```
print(datas.head())
->> 
         Date      Time  Transaction           Item
0  2016-10-30  09:58:11            1          Bread
1  2016-10-30  10:05:34            2   Scandinavian
2  2016-10-30  10:05:34            2   Scandinavian
3  2016-10-30  10:07:57            3  Hot chocolate
4  2016-10-30  10:07:57            3            Jam

[5 rows x 4 columns]
```

### å¢å¼ºæ•°æ®
ç„¶åï¼Œæˆ‘ä»¬å¯¹åŸå§‹æ•°æ®æŒ‰ç…§ä¸Šé¢åˆ†æçš„æ€è·¯è¿›è¡Œå¤„ç†ã€‚  

```
# æŒ–æ˜ï¼Œå‘¨å‡ å¯¹äº¤æ˜“é‡çš„å½±å“
datas['Weekday'] = datas['Date']
datas['Weekday'] = datas['Weekday'].map(lambda x: get_weekday(x))

# æŒ–æ˜ï¼Œå„ä¸ªèŠ‚æ—¥å¯¹äº¤æ˜“é‡çš„å½±å“
datas['Festival'] = datas['Date']
datas['Festival'] = datas['Festival'].map(lambda x: get_festival(x))

# æŒ–æ˜ï¼Œå½“å‰æ‰€å¤„çš„æ—¶é—´æ®µå¯¹äº¤æ˜“é‡çš„å½±å“
datas['Time_Quantum'] = datas['Time']
datas['Time_Quantum'] = datas['Time_Quantum'].map(lambda x: get_time_quantum(x))

# å°† Date ä¸€åˆ—å˜ä¸ºä¸ 2016-10-30 è¿™å¤©çš„è·ç¦»
datas['Date'] = datas['Date'].map(lambda x: get_delta_days(x))
# å°†æ—¶é—´è½¬å˜ä¸ºæ—¶æ®µ
datas['Time'] = datas['Time'].map(lambda x: get_time_range(x))
# ç¼©å°æ•°æ®å¤§å°
datas['Transaction'] = datas['Transaction'].map(lambda x: (float(x) / 1000.))
```

ç°åœ¨ï¼Œå†è¾“å‡ºä¸€ä¸‹æ•°æ®çœ‹çœ‹ã€‚  

```
print(datas.head())
->> 

   Date Time  Transaction  ...  Weekday Festival Time_Quantum
0   0.0    9        0.001  ...        6     null           ä¸Šåˆ
1   0.0   10        0.002  ...        6     null           ä¸Šåˆ
2   0.0   10        0.002  ...        6     null           ä¸Šåˆ
3   0.0   10        0.003  ...        6     null           ä¸Šåˆ
4   0.0   10        0.003  ...        6     null           ä¸Šåˆ

[5 rows x 7 columns]
```

ä»è¡¨æ ¼æ•°æ®ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒDate å’Œ Transaction éƒ½å˜æˆæµ®ç‚¹æ•°äº†ï¼Œå› ä¸ºæŠŠå®ƒä»¬è¿›è¡Œç¼©å°ï¼Œæœ‰åˆ©äºåé¢çš„æ¢¯åº¦ä¸‹é™ï¼Œå¦åˆ™ loss ä¼šéå¸¸éå¸¸çš„å¤§ã€‚  

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ‰©å……äº†ä¸€äº›ç‰¹å¾ã€‚  

### è¿›è¡Œ One-Hot ç¼–ç 
æ¥ä¸‹æ¥ï¼Œå¯¹äºç¦»æ•£çš„æ•°æ®ï¼Œæ¯”å¦‚ Weekdayã€Time è¿™æ ·çš„ï¼Œå®ƒçš„å¤§å°å¹¶ä¸ä¼šå¯¹äº¤æ˜“äº§ç”Ÿå½±å“ï¼Œä½†è¿™ç§ç¦»æ•£çš„ç‰¹å¾çš„ç±»åˆ«å–å€¼æ˜¯ä¼šå¯¹ç»“æœäº§ç”Ÿå½±å“çš„ã€‚æ¯”å¦‚ï¼Œæ˜¥èŠ‚è¿™å¤©ä¼šå¯¹é£Ÿç‰©çš„äº¤æ˜“é‡äº§ç”Ÿå½±å“ã€‚

æˆ‘ä»¬éœ€è¦å¯¹è¿™æ ·çš„ç‰¹å¾æ•°æ®è¿›è¡Œ **ç‹¬çƒ­ç¼–ç ** ã€‚å…³äº   **ç‹¬çƒ­ç¼–ç ** ï¼Œä½ å¯ä»¥åœ¨ CoorChice çš„ [ ã€Šæœºå™¨å­¦ä¹ ï¼Œçœ‹å®Œå°±æ˜ç™½äº†ã€‹ ](https://www.jianshu.com/p/2ffeb08d0c2a) è¿™ç¯‡æ–‡ç« ï¼Œäº†è§£ç›¸å…³ä¿¡æ¯ã€‚  

```
ont_hot_data = pd.get_dummies(datas, prefix=['Time', 'Item', 'Weekday', 'Festival', 'Time_Quantum'])
```

çœ‹çœ‹ç°åœ¨æ•°æ®è¡¨å˜æˆäº†ä»€ä¹ˆæ ·å­äº†ã€‚  

```
print(ont_hot_data.head())
->>
   Date  Transaction ...  Time_Quantum_æ™šä¸Š  Time_Quantum_æ·±å¤œ
0   0.0        0.001 ...                0                0
1   0.0        0.002 ...                0                0
2   0.0        0.002 ...                0                0
3   0.0        0.003 ...                0                0
4   0.0        0.003 ...                0                0

[5 rows x 136 columns]
```

ç»è¿‡ç‹¬çƒ­ç¼–ç åï¼Œcolumns å·²ç»æ‰©å……åˆ°äº†æƒŠäººçš„ 136 åˆ—ï¼

ä¹‹æ‰€ä»¥éœ€å¯¹æ•°æ®è¿›è¡Œç‹¬çƒ­ç¼–ç ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯åœ¨è®­ç»ƒæ—¶ï¼Œç‹¬çƒ­ç¼–ç åœ¨åˆ†ç±»æ˜¯ 0 å’Œ 1 çš„å…³ç³»ï¼Œè€Œå¦‚æœç”¨ 1ï¼Œ2ï¼Œ3ï¼Œ.. çš„åˆ†ç±»æ ‡ç­¾æ–¹å¼ï¼Œæ˜¯ä¸åˆ©äºæ¢¯åº¦ä¸‹é™çš„ï¼Œè®¡ç®—å‡ºçš„æ¢¯åº¦å¾€å¾€æ¯”è¾ƒå¤§ã€‚  

å¯¹ Dateã€Transactionï¼Œå¯ä»¥çœ‹åˆ°è¡¨æ ¼ä¸­ï¼ŒCoorChice è¿˜å¯¹ä»–ä»¬è¿›è¡Œç¼©å°ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠæ•°å€¼èŒƒå›´å˜å°ï¼Œè¿™æ ·æœ‰åˆ©äºæ¢¯åº¦ä¸‹é™çš„æ±‚è§£ã€‚  

æˆ‘ä»¬çœ‹çœ‹ç°åœ¨æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼š  

![image](http://upload-images.jianshu.io/upload_images/1869462-63813156e80df04e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### æ‰“ä¹±æ•°æ®

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å…ƒç´ çš„æœ‰åºçš„æ•°æ®è¿›è¡Œæ‰“ä¹±ï¼Œè¿™æ ·æœ‰åŠ©äºæé«˜è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚  

```
ont_hot_data = ont_hot_data.sample(frac=1, replace=False)
ont_hot_data = ont_hot_data.sample(frac=1, replace=False)
ont_hot_data = ont_hot_data.sample(frac=1, replace=False)
```

ä¸€éä¸å¤Ÿï¼Œè¦æ‰“ä¹± 3 éï¼  

![image](http://upload-images.jianshu.io/upload_images/1869462-b74bd67a2b9a7d8e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

çœ‹ Date ä¸€åˆ—ï¼Œè¯´æ˜æ•°æ®å·²ç»è¢«æ‰“çš„è¶³å¤Ÿä¹±äº†ã€‚

## ä¿å­˜æ•°æ®

æœ€åï¼Œæˆ‘ä»¬è¦æŠŠå¤„ç†å¥½çš„æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼ŒCoorChice æŒ‰å¤§æ¦‚ 30% å–æµ‹è¯•é›†æ•°æ®ï¼Œç„¶ååˆ†åˆ«ä¿å­˜ã€‚

```
# æµ‹è¯•æ•°æ®é›†å¤§å°
test_count = 6000
train_count = ont_hot_data.shape[0] - test_count
# åˆ‡å‰²å‡ºè®­ç»ƒæ•°æ®é›†
train_data = ont_hot_data[:train_count]
# åˆ‡å‰²å‡ºæµ‹è¯•æ•°æ®é›†
test_data = ont_hot_data[train_count:]
# åˆ†åˆ«ä¿å­˜ä¸¤ä¸ªæ•°æ®é›†
train_data.to_csv('data/train_data.csv', index=False, header=True)
test_data.to_csv('data/test_data.csv', index=False, header=True)
```

ä¿å­˜å¤„ç†å¥½çš„æ•°æ®å¾ˆç®€å•ï¼Œä½¿ç”¨ Pandas æä¾›çš„ `to_csv()` å°±å¯ä»¥æŠŠæ•°æ®å­˜ csv æ ¼å¼ã€‚  

index å’Œ header åˆ†åˆ«è¡¨ç¤ºæ˜¯å¦ä¿å­˜è¡Œå·å’Œåˆ—åç§°ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-89637c8f4bfe4737.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æŠŠåŸå§‹æ•°æ®å¤„ç†å¥½ï¼Œå¹¶ä¸”åˆ†å‰²æˆäº†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚æˆ‘ä»¬æœ‰ 15,293 æ¡è®­ç»ƒæ•°æ®ï¼Œå’Œ 6000 æ¡æµ‹è¯•æ•°æ®ã€‚ 

# å¼€å§‹è®­ç»ƒå§ï¼

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹ä¸€çœ‹è¿™ä¸€ç¯‡ [ ã€Šã€Getã€‘ç”¨æ·±åº¦å­¦ä¹ è¯†åˆ«æ‰‹å†™æ•°å­—ã€‹ ](https://www.jianshu.com/p/ab68c7ba964b) ï¼Œå› ä¸ºå¥—è·¯åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æœ‰çš„åœ°æ–¹éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´ã€‚  

åœ¨æ‰‹å†™æ•°å­—è¯†åˆ«ä¸­ï¼Œæˆ‘ä»¬æ„å»ºçš„æ˜¯ä¸€ä¸ªç®€å• 4 å±‚ç½‘ç»œï¼Œå®ƒç”±ä¸¤ä¸ªå·ç§¯å±‚ï¼Œä¸€ä¸ªå…¨é“¾æ¥å±‚å’Œä¸€ä¸ªè¾“å‡ºå±‚ç»„æˆã€‚  

![image_graph](http://upload-images.jianshu.io/upload_images/1869462-dbe29344483f891d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å›é¡¾ä¸€ä¸‹è¿™ä¸ªç½‘ç»œç»“æ„ã€‚  
 

## å‘ç”Ÿäº†æ¬ æ‹Ÿåˆï¼

ä¸€å¼€å§‹ï¼ŒCoorChice ç›´æ¥ä½¿ç”¨äº†è¿™ä¸ªç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œç»è¿‡ 10w æ¬¡çš„æ¼«é•¿è®­ç»ƒä¹‹åå‘ç°ï¼Œå‡†ç¡®ç‡æœ€é«˜ä¸è¿‡ 0.1%ã€‚  

èµ·åˆ CoorChice å‡å° lrï¼ˆå­¦ä¹ ç‡ï¼‰ï¼Œæƒ³ç€å¯èƒ½æ˜¯å­¦ä¹ ç‡è¿‡å¤§ï¼Œå¯¼è‡´éœ‡è¡äº†ã€‚ç„¶è€Œï¼Œæ¯«æ— ä½œç”¨ã€‚  

å‡ºç°è¿™ç§ç°è±¡ï¼ŒåŸºæœ¬å¯ä»¥åˆ¤æ–­å¤§æ¦‚ç‡ä¸Šæ˜¯å‘ç”Ÿæ¬ æ‹Ÿåˆäº†ã€‚  

å‘ç”Ÿæ¬ æ‹Ÿåˆï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¸€æ­¥æ­¥çš„æ’é™¤é—®é¢˜å’Œæ”¹è¿›ç½‘ç»œã€‚ 

### ä½¿ç”¨é€‚åˆçš„æƒé‡åˆå§‹åŒ–æ–¹æ¡ˆ

æœ¬æ¬¡è®­ç»ƒä¸­ï¼Œæƒé‡çš„åˆå§‹åŒ–æ²¿ç”¨äº†ä¸Šæ¬¡çš„æ­£å¤ªåˆ†å¸ƒåˆå§‹åŒ–æ–¹æ¡ˆï¼Œåº”è¯¥æ˜¯æ¯”è¾ƒä¼˜ç§€çš„æ–¹æ¡ˆäº†ï¼Œæ‰€ä»¥å°±ä¸åšæ”¹åŠ¨äº†ã€‚  

![image_truncated](http://upload-images.jianshu.io/upload_images/1869462-2b1dbc5919116e15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

### é€‰æ‹©é€‚å½“çš„æ¿€æ´»å‡½æ•°

åœ¨ä¸Šä¸€æ¬¡çš„ç½‘ç»œæ„å»ºä¸­ï¼Œå·ç§¯å±‚ã€å…¨é“¾æ¥å±‚éƒ½ç”¨çš„æ˜¯ ReLu æ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºå±‚ä½¿ç”¨çš„æ˜¯ Softmax æ¿€æ´»å‡½æ•°ã€‚è€Œè¿™æ¬¡ CoorChice æŠŠæ¿€æ´»å‡½æ•°å…¨æ¢æˆäº†ä¼˜ç§€çš„ ReLu æ¿€æ´»å‡½æ•°ï¼Œè¿™åº”è¯¥ä¹Ÿæ˜¯æ²¡æ¯›ç—…çš„ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-b41d3b8fab2868ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### é€‰æ‹©é€‚åˆçš„ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡

![image](http://upload-images.jianshu.io/upload_images/1869462-e6d6db3f1e13f401.gif?imageMogr2/auto-orient/strip)  

è¿™æ˜¯ä¸€å¼ å„ç§ä¼˜åŒ–å™¨çš„æ¯”è¾ƒå›¾ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªåå« Adadelta çš„ä¼˜åŒ–å™¨è¡¨ç°ååˆ†äº®çœ¼å•Šï¼  

Adadelta æ˜¯ä¸€ç§è‡ªé€‚åº”çš„ä¼˜åŒ–å™¨ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨çš„è®¡ç®—è‡ªå˜é‡æ›´æ–°é‡çš„å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨çš„å¹³å‡é¡¹æ¥ä½œä¸ºå­¦ä¹ ç‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¾ç½®çš„å­¦ä¹ ç‡å®é™…ä¸Šå½±å“å·²ç»ä¸æ˜¯å¤ªå¤§äº†ã€‚ 

ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§ä¼˜åŒ–å™¨åœ¨è®­ç»ƒä¹‹åˆå’Œä¸­æœŸåˆèƒ½å¤Ÿå¿«é€Ÿä¸‹é™ï¼Œåªä¸è¿‡åˆ°æ¥è¿‘æœ€ä¼˜è§£çš„æ—¶å€™ä¼šå‡ºç°å°å¹…éœ‡è¡ã€‚è€Œ SGD å› å…¨ç¨‹éƒ½ä¿æŒä¸€ä¸ªå­¦ä¹ ç‡ï¼Œæ‰€ä»¥åœ¨è®¾ç½®åˆé€‚çš„æƒ…å†µä¸‹ï¼Œåœ¨æœ€ä¼˜è§£é™„è¿‘æ”¶æ•›çš„æ›´å¹²è„†ã€‚  

```
# ä½¿ç”¨ Adadelta è¿›è¡ŒæŸå¤±å‡½æ•°çš„æ¢¯åº¦ä¸‹é™æ±‚è§£
train_step = tf.train.AdadeltaOptimizer(0.0001).minimize(cross_entropy)
```

ä½†ç”±äº Adadelta å®é™…è®­ç»ƒè¿‡ç¨‹ä¸­ä¸æˆ‘ä»¬èµ·åˆå‘Šè¯‰å®ƒçš„å­¦ä¹ ç‡å…³ç³»ä¸å¤§ï¼Œå°±æ˜¯ä¸å—æ§ï¼Œè®­ç»ƒèµ·æ¥åˆ°åé¢è¿˜æ˜¯å¾ˆéš¾å—çš„ï¼Œæ‰€ä»¥ CoorChice å°è¯•ä¹‹åè¿˜æ˜¯é€‰æ‹©æ¢æˆ SGD ã€‚  

```
lr = tf.Variable(1e-5)
# ä½¿ç”¨ SGD è¿›è¡ŒæŸå¤±å‡½æ•°çš„æ¢¯åº¦ä¸‹é™æ±‚è§£
train_step = tf.train.GradientDescentOptimizer(lr).minimize(cross_entropy)
```  

è€Œä¸”ï¼ŒCoorChice ä½¿ç”¨äº†ä¸€ä¸ªå˜é‡ lr æ¥è®¾ç½®ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ï¼Œè¿™æ ·åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ¨æ€çš„é¢æ§åˆ¶å½“å‰çš„å­¦ä¹ ç‡ã€‚

### å¢åŠ ç½‘ç»œæ·±åº¦ã€å®½åº¦

å½“å‘ç”Ÿæ¬ æ‹Ÿåˆæ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘ç»œè¿‡äºç®€å•ï¼Œæƒé‡å¤ªå°‘ï¼Œå¯¼è‡´æ— æ³•å­¦ä¹ åˆ°è¶³å¤Ÿçš„ä¿¡æ¯ã€‚åœ¨æœ¬æ¬¡è®­ç»ƒä¸­ï¼ŒCoorChice ä»ç„¶ä½¿ç”¨äº†ä¸Šæ¬¡çš„ 4 å±‚å•æ ¸ç½‘ç»œï¼Œä¼¼ä¹ç¡®å®æ˜¯å¤ªç®€å•äº†ã€‚  

é‚£å°±åŠ å¼ºå®ƒå§ã€‚  

```
 # coding=utf-8
from cnn_utils import *


class CnnBreadBasketNetwork:
    def __init__(self):
        with tf.name_scope("input"):
            self.x_data = tf.placeholder(tf.float32, shape=[None, 135], name='x_data')
            # è¡¥ä½
            input_data = tf.pad(self.x_data, [[0, 0], [0, 1]], 'CONSTANT')
            with tf.name_scope("input_reshape"):
                # å˜å½¢ä¸ºå¯ä»¥å’Œå·ç§¯æ ¸å·ç§¯çš„å¼ é‡
                input_data = tf.reshape(input_data, [-1, 17, 8, 1])
                tf.summary.image("input", input_data, 1)
            self.y_data = tf.placeholder(tf.float32, shape=[None], name='y_data')

        # ------------------------æ„å»ºç¬¬ä¸€å±‚ç½‘ç»œ---------------------
        with tf.name_scope("hidden1"):
            # ç¬¬ä¸€ä¸ªå·ç§¯
            with tf.name_scope("weights1"):
                W_conv11 = weight_variable([3, 3, 1, 64])
                variable_summaries(W_conv11, "W_conv11")
            with tf.name_scope("biases1"):
                b_conv11 = bias_variable([64])
                variable_summaries(b_conv11, "b_conv11")
            h_conv11 = tf.nn.relu(conv2(input_data, W_conv11) + b_conv11)
            tf.summary.histogram('activations_h_conv11', h_conv11)
            # ç¬¬äºŒä¸ªå·ç§¯
            with tf.name_scope("weights2"):
                W_conv12 = weight_variable([3, 3, 64, 64])
                variable_summaries(W_conv12, "W_conv12")
            with tf.name_scope("biases2"):
                b_conv12 = bias_variable([64])
                variable_summaries(b_conv12, "b_conv12")
            h_conv12 = tf.nn.relu(conv2(h_conv11, W_conv12) + b_conv12)
            tf.summary.histogram('activations_h_conv11', h_conv12)
            # æ± åŒ–
            h_pool1 = max_pool_2x2(h_conv12)
            tf.summary.histogram('pools_h_pool1', h_pool1)

        # ------------------------æ„å»ºç¬¬äºŒå±‚ç½‘ç»œ---------------------
        with tf.name_scope("hidden2"):
            # ç¬¬ä¸€ä¸ªå·ç§¯æ ¸
            with tf.name_scope("weights1"):
                W_conv21 = weight_variable([3, 3, 64, 128])
                variable_summaries(W_conv21, 'W_conv21')
            with tf.name_scope("biases1"):
                b_conv21 = bias_variable([128])
                variable_summaries(b_conv21, 'b_conv21')
            h_conv21 = tf.nn.relu(conv2(h_pool1, W_conv21) + b_conv21)
            tf.summary.histogram('activations_h_conv21', h_conv21)
            # ç¬¬äºŒä¸ªå·ç§¯æ ¸
            with tf.name_scope("weights2"):
                W_conv22 = weight_variable([3, 3, 128, 128])
                variable_summaries(W_conv22, 'W_conv22')
            with tf.name_scope("biases2"):
                b_conv22 = bias_variable([128])
                variable_summaries(b_conv22, 'b_conv22')
            h_conv22 = tf.nn.relu(conv2(h_conv21, W_conv22) + b_conv22)
            tf.summary.histogram('activations_h_conv22', h_conv22)
            # æ± åŒ–
            self.h_pool2 = max_pool_2x2(h_conv22)
            tf.summary.histogram('pools_h_pool2', self.h_pool2)

        shape_0 = self.h_pool2.get_shape()[1].value
        shape_1 = self.h_pool2.get_shape()[2].value
        h_pool2_flat = tf.reshape(self.h_pool2, [-1, shape_0 * shape_1 * 128])

        # ------------------------ æ„å»ºç¬¬ä¸€å±‚å…¨é“¾æ¥å±‚ ---------------------
        with tf.name_scope("fc1"):
            with tf.name_scope("weights"):
                W_fc1 = weight_variable([shape_0 * shape_1 * 128, 4096])
                variable_summaries(W_fc1, 'W_fc1')
            with tf.name_scope("biases"):
                b_fc1 = bias_variable([4096])
                variable_summaries(b_fc1, 'b_fc1')
            h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat, W_fc1) + b_fc1)
            tf.summary.histogram('activations_h_fc1', h_fc1)


        # ------------------------æ„å»ºè¾“å‡ºå±‚---------------------
        with tf.name_scope("output"):
            with tf.name_scope("weights"):
                W_out = weight_variable([4096, 1])
                variable_summaries(W_out, 'W_out')
            with tf.name_scope("biases"):
                b_out = bias_variable([1])
                variable_summaries(b_out, 'b_out')
            # æ³¨æ„âš ï¸ï¼Œæ­¤å¤„çš„æ¿€æ´»å‡½æ•°å·²ç»æ›¿æ¢æˆ ReLu äº†
            self.y_conv = tf.nn.relu(tf.matmul(h_fc1, W_out) + b_out)
            tf.summary.histogram('activations_y_conv', self.y_conv)

```

è¿™å°±æ˜¯ç»è¿‡æ”¹è¿›åçš„ç½‘ç»œçš„å…¨éƒ¨ä»£ç äº†ã€‚  

å¯ä»¥çœ‹åˆ°ï¼Œè¿˜æ˜¯ç†Ÿæ‚‰çš„å¥—è·¯ã€‚ä»¥ä¸‹æ˜¯ç‰ˆæœ¬æ›´æ–°å†…å®¹ï¼š 

- æ¯ä¸ªå·ç§¯æ ¸çš„ size ç”± 5x5 å˜æˆäº† 3x3 

- ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„å·ç§¯æ ¸é€šé“æ•°ç”±åŸæ¥çš„ 32 å¢åŠ åˆ°äº† 64ã€‚å°†å·ç§¯æ ¸æ•°é‡æé«˜ä¸€å€ã€‚


- å·ç§¯æ ¸å±‚æ•°ä»ç„¶æ˜¯ä¸¤å±‚ï¼Œä½†æ¯å±‚éƒ½å¤šå¢åŠ äº†ä¸€ä¸ªå·ç§¯æ ¸ç»„ã€‚


- å…¨é“¾æ¥å±‚çš„ç¥ç»å…ƒä¸ªæ•°ç”±åŸæ¥çš„ 1024 ä¸ªå¢åŠ è‡³ 4096 ä¸ªã€‚


å†è¯´ä¸€ä¸‹ç½‘ç»œä¸­çš„ä¸€äº›å˜åŒ–ã€‚  

```
self.x_data = tf.placeholder(tf.float32, shape=[None, 135], name='x_data')
    # è¡¥ä½
input_data = tf.pad(self.x_data, [[0, 0], [0, 1]], 'CONSTANT')
    # å˜å½¢ä¸ºå¯ä»¥å’Œå·ç§¯æ ¸å·ç§¯çš„å¼ é‡
input_data = tf.reshape(input_data, [-1, 17, 8, 1])
self.y_data = tf.placeholder(tf.float32, shape=[None], name='y_data')
```

å®šä¹‰å ä½çš„æ—¶å€™ï¼Œç”±äºè¡¨æ ¼æ•°æ®ä¸­åªæœ‰ 135 åˆ—ï¼Œæ‰€ä»¥å…ˆå®šä¹‰ä¸€ä¸ª shape ä¸º [Noneï¼Œ135] çš„å ä½ã€‚ä½†æ˜¯æ¯”è¾ƒå°´å°¬çš„æ˜¯ï¼Œ135 æ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œæ— æ³•è½¬æ¢æˆèƒ½å’Œå·ç§¯æ ¸å·ç§¯çš„å¼ é‡ï¼Œæ‰€ä»¥ CoorChice ç»™å®ƒè¡¥äº†ä¸€åˆ—ï¼Œé€šè¿‡ tensorflow æä¾›çš„ `pad()` å‡½æ•°ã€‚  

```
input_data = tf.pad(self.x_data, [[0, 0], [0, 1]], 'CONSTANT')
```

ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„æ•°å­—åˆ†åˆ«è¡¨ç¤ºéœ€è¦åœ¨åŸå¼ é‡çš„ **ä¸Šã€ä¸‹ã€å·¦ã€å³** è¡¥å……å¤šå°‘è¡Œæˆ–åˆ—ã€‚è¿™é‡Œ CoorChice å†åŸå¼ é‡çš„å³è¾¹è¡¥å……äº†ä¸€åˆ— 0ã€‚  

ç°åœ¨ï¼Œå°±å¯ä»¥å˜å½¢æˆå¯å’Œå·ç§¯æ ¸å·ç§¯çš„å¼ é‡äº†ã€‚  

```
input_data = tf.reshape(input_data, [-1, 17, 8, 1])
```

> - **å°æŠ€å·§ï¼š**é€šå¸¸ï¼Œç»è¿‡å¤šå±‚çš„å·ç§¯å’Œæ± åŒ–ä¹‹åï¼Œè¿›å…¥ç¬¬ä¸€å±‚å…¨é“¾æ¥å±‚æˆ–è€…ç›´æ¥è¿›å…¥è¾“å‡ºå±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸Šä¸€å±‚çš„å½¢çŠ¶æ˜¯æ€æ ·çš„ï¼Œç„¶åæ‰èƒ½è®¾è®¡å…¨é“¾æ¥å±‚æˆ–è€…è¾“å‡ºå±‚çš„æƒé‡å½¢çŠ¶ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ–¹ä¾¿çš„è·å¾—è¾“å…¥çš„å½¢çŠ¶ï¼š  

```
# è·å¾—æœ€åä¸€ä¸ªæ± åŒ–å±‚çš„å®½
shape_0 = self.h_pool2.get_shape()[1].value
# è·å¾—æœ€åä¸€ä¸ªæ± åŒ–å±‚çš„é«˜
shape_1 = self.h_pool2.get_shape()[2].value

# å˜å½¢ä¸ºå…¨é“¾æ¥å±‚å¯ä¹˜çš„å½¢çŠ¶
h_pool2_flat = tf.reshape(self.h_pool2, [-1, shape_0 * shape_1 * 128])
```

å®é™…ä¸Šï¼Œè¿™ä¸ªç½‘ç»œå¯èƒ½ä¸æ˜¯å¤ªå¥½ï¼Œæ·±åº¦ä¸å¤Ÿï¼Œå¯èƒ½å¯¼è‡´å‡†ç¡®ç‡ä¸å¤Ÿã€‚ä½†å—è®¾å¤‡é™åˆ¶ï¼Œè®¾è®¡çš„å¤ªæ·±ï¼Œä¼šå¯¼è‡´æ¯æ¬¡è®­ç»ƒéƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œæ‰€ä»¥ CoorChice å°±å°½é‡ç²¾ç®€ä¸€ç‚¹ï¼Œä¸»è¦çœ‹è¿™ä¸ªè¿‡ç¨‹æ˜¯æ€æ ·è¿›è¡Œçš„ã€‚  

è¿™æ˜¯æ–°çš„ç½‘ç»œç»“æ„ï¼š  

![image](http://upload-images.jianshu.io/upload_images/1869462-227255f0d0fd9b18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

çœ‹çœ‹å±€éƒ¨çš„ä¸¤ç»„å·ç§¯ hidden å±‚ï¼š  

![image](http://upload-images.jianshu.io/upload_images/1869462-83eb5a5b05743d89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## å¼€å¯è®­ç»ƒ!

```
# coding=utf-8
import time
from cnn_model import *
from BBDATA import *

train_times = 20000
base_path = ".../BreadBasket/"
save_path = base_path + str(train_times) + "/"

# è¯»å–æ•°æ®
BBDATA = read_datas('data/')

# åˆ›å»ºç½‘ç»œ
network = CnnBreadBasketNetwork()
x_data = network.x_data
y_data = network.y_data
y_conv = network.y_conv
keep_prob = network.keep_prob
# ------------------------æ„å»ºæŸå¤±å‡½æ•°---------------------
with tf.name_scope("cross_entropy"):
    # åˆ›å»ºæ­£åˆ™åŒ–å¯¹è±¡ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯ L2 èŒƒæ•°
    regularization = tf.contrib.layers.l2_regularizer(scale=(5.0 / 500))
    # åº”ç”¨æ­£åˆ™åŒ–åˆ°å‚æ•°é›†ä¸Š
    reg_term = tf.contrib.layers.apply_regularization(regularization)
    # åœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥æ­£åˆ™åŒ–é¡¹
    cross_entropy = tf.reduce_mean(tf.square((y_conv - y_data))) + reg_term
    tf.scalar_summary('loss', cross_entropy)

with tf.name_scope("train_step"):
    lr = tf.Variable(1e-5)
    # ä½¿ç”¨ SGD è¿›è¡ŒæŸå¤±å‡½æ•°çš„æ¢¯åº¦ä¸‹é™æ±‚è§£
    train_step = tf.train.GradientDescentOptimizer(lr).minimize(cross_entropy)

# è®°å½•å¹³å‡å·®å€¼
with tf.name_scope("difference_value"):
    dv = tf.reduce_mean(tf.abs(y_conv - y_data))
    tf.scalar_summary('difference_value', cross_entropy)

# ------------------------æ„å»ºæ¨¡å‹è¯„ä¼°å‡½æ•°---------------------
with tf.name_scope("accuracy"):
    with tf.name_scope("correct_prediction"):
        correct_prediction = tf.less_equal(tf.abs(y_conv - y_data), 0.5)
    with tf.name_scope("accuracy"):
        # è®¡ç®—å‡†ç¡®ç‡
        accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))
tf.scalar_summary('accuracy', accuracy)

# åˆ›å»ºä¼šè¯
sess = tf.InteractiveSession()

summary_merged = tf.merge_all_summaries()
train_writer = tf.train.SummaryWriter(save_path + "graph/train", sess.graph)
test_writer = tf.train.SummaryWriter(save_path + "graph/test")

start_time = int(round(time.time() * 1000))

# åˆå§‹åŒ–å‚æ•°
sess.run(tf.initialize_all_variables())

global loss
loss = 0
global train_accuracy
for i in range(train_times):
    # ä»è®­ç»ƒé›†ä¸­å–å‡º 200 ä¸ªæ ·æœ¬è¿›è¡Œä¸€æ³¢è®­ç»ƒ
    batch = BBDATA.train_data.batch(200)

    if i % 100 == 0:
        summary, train_accuracy, test_loss, dv_value = sess.run([summary_merged, accuracy, cross_entropy, dv],
                                           feed_dict={x_data: BBDATA.test_data.data, y_data: BBDATA.test_data.label, keep_prob: 1})
        test_writer.add_summary(summary, i)
        consume_time = int(round(time.time() * 1000)) - start_time
        print("å½“å‰å…±è®­ç»ƒ " + str(i) + "æ¬¡, ç´¯è®¡è€—æ—¶ï¼š" + str(consume_time) + "msï¼Œå®æ—¶å‡†ç¡®ç‡ä¸ºï¼š%g" % (train_accuracy * 100.) + "%, "
             + "å½“å‰è¯¯å·®å‡å€¼ï¼š" + str(dv_value) + ", train_loss = " + str(loss) + ", test_loss = " + str(test_loss))
    if i % 1000 == 0:
        run_options = tf.RunOptions(trace_level=tf.RunOptions.FULL_TRACE)
        run_metadata = tf.RunMetadata()
        summary, _, loss = sess.run([summary_merged, train_step, cross_entropy],
                              feed_dict={x_data: batch.data, y_data: batch.label, keep_prob: 0.6}, options=run_options,
                              run_metadata=run_metadata)
        train_writer.add_run_metadata(run_metadata, str(i))
        train_writer.add_summary(summary, i)
    else:
        summary, _, loss = sess.run([summary_merged, train_step, cross_entropy],
                              feed_dict={x_data: batch.data, y_data: batch.label, keep_prob: 0.6})
        train_writer.add_summary(summary, i)

    # æ¯è®­ç»ƒ 2000 æ¬¡ä¿å­˜ä¸€æ¬¡æ¨¡å‹
    if i != 0 and i % 1000 == 0:
        test_accuracy, test_dv = sess.run([accuracy, dv], feed_dict={x_data: BBDATA.test_data.data, y_data: BBDATA.test_data.label, keep_prob: 1})
        save_model(base_path + str(i) + "_" + str(test_dv) + "/", sess, i)

# åœ¨æµ‹è¯•é›†è®¡ç®—å‡†ç¡®ç‡
summary, final_test_accuracy, test_dv = sess.run([summary_merged, accuracy, dv],
                                  feed_dict={x_data: BBDATA.test_data.data, y_data: BBDATA.test_data.label, keep_prob: 1})
train_writer.add_summary(summary)
print("æµ‹è¯•é›†å‡†ç¡®ç‡ï¼š%g" % (final_test_accuracy * 100.) + "%, è¯¯å·®å‡å€¼ï¼š" + str(test_dv))

print("è®­ç»ƒå®Œæˆï¼")
train_writer.close()
test_writer.close()
# ä¿å­˜æ¨¡å‹
save_model(save_path, sess, train_times)

sess.close()
```

è¿™æ˜¯å®Œæ•´çš„è®­ç»ƒä»£ç ï¼ŒåŸºæœ¬ä¸Šå’Œ[ ã€Šã€Getã€‘ç”¨æ·±åº¦å­¦ä¹ è¯†åˆ«æ‰‹å†™æ•°å­—ã€‹ ](https://www.jianshu.com/p/ab68c7ba964b) ä¸­æ˜¯ä¸€æ ·çš„ã€‚åªä¸è¿‡ CoorChice å¤šåŠ äº†ä¸€ä¸ª MAE ä½œä¸ºæ¨¡å‹è¯„ä¼°çš„æŒ‡æ ‡ã€‚

```
dv = tf.reduce_mean(tf.abs(y_conv - y_data))
```

å› ä¸ºæ˜¯è¿›è¡Œå›å½’é¢„æµ‹ï¼Œæ‰€ä»¥ä½¿ç”¨ MAE å‡æ–¹æ–¹å·®æ¥ä½œä¸ºä¸€ä¸ªè¯„ä¼°æ¨¡å‹å¥½åçš„æŒ‡æ ‡ã€‚å¹³å‡ç»å¯¹å·®è¶Šå°ï¼Œè¡¨æ˜æ¨¡å‹é¢„æµ‹ç»“æœè¶Šæ¥è¿‘äºçœŸå®æƒ…å†µã€‚  

æ­¤å¤–ï¼Œç”±äºæ˜¯åšå›å½’é¢„æµ‹ï¼Œæ‰€ä»¥ä¹‹å‰åˆ†ç±»ä½¿ç”¨çš„äº¤å‰ç†µæŸå¤±å‡½æ•°å°±ä¸æ˜¯ç‰¹åˆ«åˆé€‚äº†ï¼Œæˆ‘ä»¬æ¢æˆå‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-5f0c47b27425d5cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

```
cross_entropy = tf.reduce_mean(tf.square((y_conv - y_data))) + reg_term
```  

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

```
correct_prediction = tf.less_equal(tf.abs(y_conv - y_data), 0.5)
```

è¯„ä¼°æ¨¡å‹ç°åœ¨ä¸åº”è¯¥å†æ˜¯æ¯”è¾ƒé¢„æµ‹å€¼å’Œæ ‡ç­¾å€¼æ˜¯å¦ç›¸ç­‰äº†ï¼Œåœ¨å›å½’é¢„æµ‹ä¸­ï¼Œè¦åšåˆ°æ¨¡å‹èƒ½å¤Ÿé¢„æµ‹å‡ºçš„å€¼å’ŒçœŸå®å€¼å®Œå…¨ç›¸ç­‰å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘ä»¬æŠŠè¯„ä¼°æ¨¡å‹æ”¹é€ æˆç»å¯¹å·® <500 å³æ¥å—è¯¥é¢„æµ‹ç»“æœï¼Œæ¯•ç«Ÿæ˜¯åœ¨ä¸ªäººè®¾å¤‡ä¸Šè·‘ï¼Œè¦è¾¾åˆ°æ¯”è¾ƒé«˜çš„ç²¾åº¦è¿˜æ˜¯å¾ˆéš¾çš„ã€‚

## loss ä¸ä¸‹é™äº†

ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼ŒSGD ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡å˜é‡å®é™…ä¸Šæ˜¯ CoorChice åæ¥åŠ ä¸Šçš„ã€‚åœ¨æ­¤å‰ï¼Œä½¿ç”¨çš„å›ºå®šçš„ï¼Œä½†å½“ run èµ·æ¥å¼€å§‹è®­ç»ƒçš„æ—¶å€™ï¼Œå‘ç° loss æ€»åœ¨ä¸€ä¸ªå€¼å¾ˆå¤§ï¼Œä½†èŒƒå›´å¾ˆå°çš„åŒºé—´å†…æ³¢åŠ¨ï¼Œè€Œä¸”å‡†ç¡®ç‡ä¹Ÿåœ¨å°èŒƒå›´çš„æ³¢åŠ¨ï¼Œæå‡ä¸ä¸Šå»ã€‚  

- æŸå¤±å˜åŒ–æ›²çº¿

![image](http://upload-images.jianshu.io/upload_images/1869462-2cb8fb983492d686.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



- å‡†ç¡®ç‡å˜åŒ–æ›²çº¿

![image](http://upload-images.jianshu.io/upload_images/1869462-eec1c921f3c5d7ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ­¤æ—¶çš„å‡†ç¡®å¤§æ¦‚åœ¨ **10.5%** é™„è¿‘å¾˜å¾Šå¼€æ¥ï¼Œloss è¶‹åŠ¿å˜åŒ–ä¹Ÿä¸å¤§ã€‚  

è¿™è¯´æ˜è®­ç»ƒåŸºæœ¬å¤„äºåœæ»ä¸å‰çš„çŠ¶æ€äº†ï¼Œä½†æ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ç²¾åº¦æ˜¯ä¸å¤Ÿçš„ã€‚å‡ºç°è¿™ç§æƒ…å†µå¯èƒ½æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µã€‚

### é™·å…¥å±€éƒ¨æœ€ä¼˜è§£

![image](http://upload-images.jianshu.io/upload_images/1869462-8e3102a163e6b911.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

å¦‚å›¾ï¼Œåœ¨å¤šç‰¹å¾çš„é«˜ç»´ loss æ›²é¢ä¸­ï¼Œå¯èƒ½å­˜åœ¨å¾ˆå¤š A ç‚¹æ—è¾¹çš„å°å‘ã€‚å½“è¿›å…¥å°å‘çš„åº•éƒ¨æ—¶ï¼Œloss çš„ä¸€é˜¶å¯¼æ•°ä¹Ÿæ˜¯ä¸º 0 çš„ï¼Œå°±ç½‘ä¸Šå¸¸å¸¸è¯´çš„é™·å…¥äº†å±€éƒ¨æœ€ä¼˜è§£ä¸­ï¼Œè€Œæ²¡æœ‰åˆ°çœŸæ­£çš„ Global Minimaã€‚  

å®é™…ä¸Šï¼Œä¸Šé¢ä»£ç ä¸­æˆ‘ä»¬é‡‡å–çš„ mini-patch æŠ½æ ·è¿›è¡Œè®­ç»ƒï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæ˜¯èƒ½å‡å°é™·å…¥å±€éƒ¨æœ€ä¼˜è§£çš„æƒ…å†µçš„ã€‚å› ä¸ºå¯èƒ½è¿™æ‰¹æ ·æœ¬é™·å…¥äº†å±€éƒ¨æœ€ä¼˜ä¸­ï¼Œä¸‹ä¸€æ‰¹æ ·æœ¬çš„æ³¢åŠ¨åˆæŠŠä½ ä»å‘é‡Œæ‹½å‡ºæ¥äº†ã€‚å½“ç„¶æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ° loss åè€Œå¢å¤§äº†ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™ç§æ–¹å¼å¯¼è‡´çš„ã€‚

### éª‘åœ¨éç‚¹ä¸Š

![image](http://upload-images.jianshu.io/upload_images/1869462-e154a0c8e4bacf1f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¦‚å›¾ï¼Œåœ¨ loss çš„æ›²é¢ä¸­ï¼Œä¼šæœ‰æ¯”å±€éƒ¨æœ€ä¼˜å‘è¿˜å¤šçš„é©¬éå‹æ›²é¢ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-019a40e0e5a55829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  

æ†¨æ€å¯æ¬çš„ğŸ...

å½“æˆ‘ä»¬éª‘åˆ°é©¬éä¸Šçš„éç‚¹æ˜¯ï¼Œæ­¤å¤„çš„å¯¼æ•°ä¹Ÿæ˜¯ä¸º0çš„ï¼Œé‚£ä¹ˆæ˜¯çœŸæ­£çš„æ”¶æ•›äº†å—ï¼Ÿä¸æ˜¯çš„ã€‚çœ‹å›¾ä¸­ï¼Œæˆ‘ä»¬åœ¨xè½´æ–¹å‘ä¸Šæ˜¯æå°å€¼ï¼Œä½†åœ¨yè½´æ–¹å‘ä¸Šæ˜¯æå¤§å€¼ã€‚  

![image](http://upload-images.jianshu.io/upload_images/1869462-e019ee1e2ca5ae0a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

å¦‚æœè½åœ¨è¿™æ ·æ­£åœ¨è¿›å…¥éç‚¹çš„å°´å°¬ä½ç½®ï¼Œé‚£ä¹ˆä½ çš„è®­ç»ƒå°±ä¼šçœ‹èµ·æ¥å‡ ä¹æ¯«æ— æ³¢åŠ¨ï¼Œèµ°å‡ºè¿™ä¸ªåŒºåŸŸéœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚  

å¹¸è¿çš„æ˜¯ï¼Œé€šè¿‡é€‚å½“å¢å¤§å­¦ä¹ ç‡æˆ–è€…é€‚å½“å‡å° batchï¼Œéƒ½æœ‰åŠ©äºå°½å¿«é€ƒç¦»è¿™ä¸ªåŒºåŸŸã€‚  

### æ— å°½çš„å¹³ç¼“é¢

![image](http://upload-images.jianshu.io/upload_images/1869462-d914fc12df6b0cdb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç„¶ååœ¨ loss æ›²é¢ä¸­ï¼ŒåŒæ—¶å­˜åœ¨ç€å¦‚ä¸Šå›¾ä¸€æ ·çš„å¤§é¢ç§¯çš„å¹³ç¼“æ›²é¢ï¼Œå¤„äºè¿™äº›åŒºåŸŸä¸­çš„ç‚¹ï¼Œè™½ç„¶å¯¼æ•°ä¸ä¸º 0 ï¼Œä½†å€¼å´åŠå…¶çš„å°ï¼Œå³ä½¿ä¸€éåˆä¸€éçš„åå¤è®­ç»ƒï¼Œä»ç„¶çœ‹èµ·æ¥å‡ ä¹æ²¡æœ‰å˜åŒ–ã€‚


å¯æ€•çš„æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•åˆ†è¾¨å‡ºæ˜¯å¤„äºå±€éƒ¨æœ€ä¼˜ï¼Œè¿˜æ˜¯å¤„äºé©¬éåŒºåŸŸï¼Œæˆ–è€…å¹²è„†å°±æ˜¯åœ¨ç±»å¹³é¢ä¸Šã€‚  

### å¦‚ä½•å¤„ç†ï¼Ÿ

å‡ºç°ä»¥ä¸Šå‡ ç§æƒ…å†µï¼Œéƒ½ä¼šå¯¼è‡´çœ‹èµ·æ¥ä¸å­¦ä¹ çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨æ€§èƒ½æœ‰é™çš„ä¸ªäººè®¾å¤‡ä¸Šã€‚ä½†æˆ‘ä»¬è¿˜æ˜¯æœ‰ä¸€äº›å¥—è·¯å¯ä»¥å°½é‡å‡å°è¿™ç§æƒ…å†µçš„å‘ç”Ÿçš„ã€‚  

1. æ£€æŸ¥æ•°æ®ã€‚ç¡®ä¿æ•°æ®æ ‡ç­¾å¯¹åº”æ­£å¸¸ã€‚


2. ä¿®æ”¹è°ƒæ•´ç½‘ç»œç»“æ„ã€‚å°½é‡ä½¿ç”¨ä¸€äº›å¼€æºçš„å¤§ç‰›ä»¬äº§å‡ºçš„ç½‘ç»œæ¨¡å‹ï¼Œå¦‚ VGG ç³»åˆ—ã€‚åœ¨å®ƒä»¬çš„åŸºç¡€ä¸Šä¿®æ”¹å¤§æ¦‚ç‡ä¸Šæ¯”è‡ªå·±æ£è…¾é è°±ã€‚


3. è°ƒæ•´ batch å¤§å°ã€‚batchè¿‡å¤§å¯¼è‡´è®­ç»ƒæ—¶é—´è¿‡é•¿ï¼Œä¹Ÿå®¹æ˜“è¿›å…¥å±€éƒ¨æœ€ä¼˜æˆ–è€…é©¬éåŒºåŸŸã€‚è¿‡å°åˆå›å¯¼è‡´éœ‡è¡æ¯”è¾ƒå‰§çƒˆï¼Œä¸å®¹æ˜“æ‰¾åˆ°æœ€ä¼˜è§£ã€‚


4. å¤šå°è¯•ä¸åŒçš„å‚æ•°åˆå§‹åŒ–ã€‚å¦‚æœè¶³å¤Ÿå¹¸è¿çš„è¯ï¼Œæ²¡å‡†åˆå§‹åŒ–å°±è½åˆ°äº† Global Minima çš„å‘é‡Œå»äº†ã€‚


5. åŠ¨æ€å­¦ä¹ ç‡ã€‚ä¸€æˆä¸å˜çš„å°çš„å­¦ä¹ ç‡å½“é™·å…¥å±€éƒ¨æœ€ä¼˜æ—¶å°±ç®—æ˜¯æ‰å‘é‡Œäº†ï¼Œæˆ–è€…åœ¨å¹³æ»‘é¢ä¸Šç§»åŠ¨çš„ç‰¹åˆ«æ…¢ã€‚å¦‚æœå¤§äº†åˆå®¹æ˜“é”™è¿‡æœ€ä¼˜è§£ã€‚æ‰€ä»¥åƒ Adam è¿™æ ·åŠ¨æ€çš„å­¦ä¹ ç‡ä¼˜åŒ–å™¨èƒ½ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è¿™äº›é—®é¢˜çš„å‘ç”Ÿã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ SGD çš„åŸºç¡€ä¸Šï¼Œæ ¹æ® loss çš„æƒ…å†µè‡ªå·±åŠ¨æ€çš„å¢å¤§å­¦ä¹ ç‡ï¼Œåœ¨ loss å¾ˆå¤§å´ä¸å˜çš„æ—¶å€™ï¼Œåœ¨ loss è¾ƒå°çš„æ—¶å€™å‡å°å­¦ä¹ ç‡ï¼Œé¿å…é”™è¿‡æœ€ä¼˜è§£ã€‚


## é€šè¿‡ loss å¤§è‡´çš„åˆ¤æ–­é—®é¢˜  

- train loss ä¸æ–­ä¸‹é™ï¼Œtest lossä¸æ–­ä¸‹é™ï¼Œè¯´æ˜ç½‘ç»œä»åœ¨å­¦ä¹ ;

- train loss ä¸æ–­ä¸‹é™ï¼Œtest lossè¶‹äºä¸å˜ï¼Œè¯´æ˜ç½‘ç»œè¿‡æ‹Ÿåˆ;

- train loss è¶‹äºä¸å˜ï¼Œtest lossä¸æ–­ä¸‹é™ï¼Œè¯´æ˜æ•°æ®é›†100%æœ‰é—®é¢˜;

- train loss è¶‹äºä¸å˜ï¼Œtest lossè¶‹äºä¸å˜ï¼Œè¯´æ˜å­¦ä¹ é‡åˆ°ç“¶é¢ˆï¼Œéœ€è¦å‡å°å­¦ä¹ ç‡æˆ–æ‰¹é‡æ•°ç›®;

- train loss ä¸æ–­ä¸Šå‡ï¼Œtest lossä¸æ–­ä¸Šå‡ï¼Œè¯´æ˜ç½‘ç»œç»“æ„è®¾è®¡ä¸å½“ï¼Œè®­ç»ƒè¶…å‚æ•°è®¾ç½®ä¸å½“ï¼Œæ•°æ®é›†ç»è¿‡æ¸…æ´—ç­‰é—®é¢˜ã€‚ 

é€šè¿‡ loss å¯ä»¥å¤§è‡´çš„åˆ¤æ–­ä¸€äº›é—®é¢˜ï¼Œä¸Šè¿°è§„å¾‹å¯ä»¥æœ€ä¸ºå‚è€ƒï¼Œä½†ä¸ä¿è¯ä¸€å®šå‡†ç¡®ã€‚  



# æ€»ç»“

æœ€åï¼Œä¸€å¼ å›¾åšä¸ªæ€»ç»“ï¼š  

![image](http://upload-images.jianshu.io/upload_images/1869462-a42fb9dac2370e81.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  



 
 
> - æŠ½å‡ºç©ºä½™æ—¶é—´å†™æ–‡ç« åˆ†äº«éœ€è¦åŠ¨åŠ›ï¼Œå„ä½çœ‹å®˜åŠ¨åŠ¨å°æ‰‹ç‚¹ä¸ªèµå“ˆï¼Œä¿¡ä»°è¿˜æ˜¯éœ€è¦æŒç»­å……å€¼çš„ğŸ˜„
> - CoorChice ä¸€ç›´åœ¨ä¸å®šæœŸçš„åˆ†äº«æ–°çš„å¹²è´§ï¼Œæƒ³è¦ä¸Šè½¦åªéœ€è¿›åˆ° [ CoorChiceçš„ã€ä¸ªäººä¸»é¡µã€‘ ](https://juejin.im/user/57fc43b67db2a200595ffd94)ç‚¹ä¸ªå…³æ³¨å°±å¥½äº†å“¦ã€‚

