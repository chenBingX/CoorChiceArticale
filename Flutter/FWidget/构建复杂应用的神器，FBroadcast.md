
[![](https://gw.alicdn.com/tfs/TB10J77tNv1gK0jSZFFXXb0sXXa-720-353.png)](https://github.com/Fliggy-Mobile)

> **FWidget** ç”¨å¿ƒæä¾›ç²¾è‡´çš„ç»„ä»¶ï¼ŒåŠ©æ‚¨æ„å»ºç²¾ç¾çš„åº”ç”¨ã€‚


![](https://gw.alicdn.com/tfs/TB1IjopQUT1gK0jSZFrXXcNCXXa-1560-840.png)


**FWidget** ä¸€ç›´è‡´åŠ›äºä¸ºå¼€å‘è€…ä»¬ç²¾å¿ƒæ‰“é€ æ˜“äºæ„å»ºç²¾ç¾åº”ç”¨çš„ **Widget**ã€‚

è¿„ä»Šä¸ºæ­¢ï¼Œ**FWidget** å·²ç»æ”¶åˆ°äº†æ¥è‡ªå¼€å‘è€…ä»¬çš„ **1215** ä¸ª **Star**ï¼Œæ„Ÿè°¢å¼€å‘è€…ä»¬çš„æ”¯æŒï¼Œè¿™å¯¹ **FWidget** æ¥è¯´**è‡³å…³é‡è¦**ã€‚

ä»Šå¤©ï¼Œ**FWidget** ä¸ºå¼€å‘è€…ä»¬å¸¦æ¥äº†ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ **FBroadcast**ï¼Œä»¥å¸®åŠ©å¼€å‘è€…ä»¬èƒ½å¤Ÿæ›´è½»æ¾çš„æ„å»ºæ›´ä¸ºå¤æ‚ç²¾ç¾çš„åº”ç”¨ã€‚

ä¾‹å¦‚ï¼Œåœ¨ **FWidget** çš„å®˜æ–¹ç½‘ç«™ [**https://fwidget.cn**](https://fwidget.cn) ä¸­ï¼Œé€šè¿‡ **FBroadcast** å¾ˆè½»æ¾çš„å°±å®ç°äº†æˆæœ¬æä½çš„ï¼Œä¸”æ˜“äºç»´æŠ¤çš„**å…¨å±€å®æ—¶è¯­è¨€åˆ‡æ¢**ã€‚å®ƒååˆ†ç®€å•æœ‰æ•ˆå’Œæ˜ç¡®ï¼

![](https://gw.alicdn.com/tfs/TB1atr.QUY1gK0jSZFMXXaWcVXa-720-511.gif)

# âœ¨ ç‰¹æ€§

æ¥çœ‹çœ‹ **FBroadcast** ä¸ºå¼€å‘è€…æä¾›äº†é‚£äº›ä¸å¯æ€è®®çš„èƒ½åŠ›æ”¯æŒï¼š

- æ”¯æŒ**å‘é€**å’Œ**æ¥æ”¶**æŒ‡å®šç±»å‹çš„æ¶ˆæ¯

- æ¶ˆæ¯æ”¯æŒæºå¸¦**ä»»æ„ç±»å‹**æ•°æ®åŒ…

- æä¾›**ç¯å¢ƒæ³¨å†Œ**ï¼Œä¸€è¡Œä»£ç å³å¯ç§»é™¤ç¯å¢ƒå†…æ‰€æœ‰æ¥æ”¶è€…

- ä¸å¯æ€è®®çš„**ç²˜æ€§å¹¿æ’­**

- **åŒå‘é€šä¿¡**æ”¯æŒ

- æ˜“äºæ„å»ºç®€å•æ˜ç¡®çš„å±€éƒ¨å’Œå…¨å±€çŠ¶æ€ç®¡ç†


![](https://gw.alicdn.com/tfs/TB1mDbBGND1gK0jSZFsXXbldVXa-360-324.png)

# ğŸ›¸ ä¼ é€åŒº

#### ğŸ›¸ [ã€ä¼ é€é—¨ï¼šFBroadcast Github ä¸»é¡µã€‘](https://github.com/Fliggy-Mobile/fbroadcast)

#### ğŸ“– [ã€ä¼ é€é—¨ï¼šFBroadcast æ–‡æ¡£ã€‘](https://pub.dev/documentation/fbroadcast/latest/fbroadcast/fbroadcast-library.html)

# ğŸ¹ çŒ®ç»™å¼€å‘è€…çš„ FBroadcast 

**FBroadcast** æ˜¯ä¸€å¥—é«˜æ•ˆçµæ´»çš„**å¹¿æ’­ç³»ç»Ÿ**ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…**è½»æ¾ã€æœ‰åº**çš„æ„å»ºå…·æœ‰æå…·å¤æ‚æ€§çš„**å…³è”äº¤äº’**å’Œ**çŠ¶æ€å˜åŒ–**çš„ç²¾ç¾åº”ç”¨ã€‚


![](https://gw.alicdn.com/tfs/TB1xVcSe9R26e4jSZFEXXbwuXXa-1456-528.png)


**FBroadcast** å°†ä¸ºæ„å»ºå¤æ‚çš„ç²¾ç¾åº”ç”¨å¸¦æ¥é‚£äº›æ˜¾è€Œæ˜“è§çš„æ”¹å˜å‘¢ï¼Ÿ

- **Widget/æ¨¡å—é—´çš„å®Œå…¨è§£è€¦**  
 
    é€šè¿‡ **FBroadcast** é«˜æ•ˆçš„å¹¿æ’­ç³»ç»Ÿï¼Œå¼€å‘è€…å¯ä»¥è½»æ˜“çš„å®Œæˆ**Widget/æ¨¡å—**çš„è§£è€¦ã€‚åœ¨åº”ç”¨æ„å»ºçš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦ **Widget/æ¨¡å—Aã€Bã€Cã€..** ä¹‹é—´æ ¹æ®äº¤äº’æ“ä½œäº’ç›¸å˜æ›´çŠ¶æ€æˆ–æ•°æ®ï¼Œå¼€å‘è€…ä»¬ä¸å¾—ä¸ä¸ºæ­¤è®©å„ä¸ª**Widget/æ¨¡å—äº’ç›¸ä¾èµ–**æˆ–è€…ä¸ºå®ƒä»¬å»ºç«‹**ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†**ï¼Œè¿™èƒ½è§£å†³é—®é¢˜ï¼Œä½†è¿™è®©æ„å»ºå˜å¾—éº»çƒ¦ï¼Œä¹Ÿè®©å˜æ›´å˜å¾—éš¾ä»¥è¿›è¡Œã€‚
    
    **FBroadcast** é€šè¿‡å»ºç«‹èµ·**ç®€å•ã€æœ‰æ•ˆã€æ˜ç¡®**å¹¿æ’­ç³»ç»Ÿï¼Œä½¿å¾—åœ¨ä»»æ„**Widget/æ¨¡å—**ä¸­**ä»»æ„æ—¶åˆ»/ä½ç½®**çš„æ”¹å˜èƒ½å¤Ÿä¸»åŠ¨å‘å‡ºå¹¿æ’­ï¼Œè€Œéœ€è¦æ ¹æ®è¿™äº›å˜æ›´ä½œå‡º**å“åº”æˆ–æ›´æ–°è§†å›¾**çš„**Widget/æ¨¡å—**åªéœ€è¦æ³¨å†Œç›¸åº”çš„**ä¿¡æ¯æ¥æ”¶å™¨**ï¼Œå°±å¯ä»¥åœ¨å˜æ›´å‘ç”Ÿæ—¶ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä½œå‡ºå“åº”ã€‚è¿™ä½¿å¾—å…³è”æ¨¡å—é—´ä¸å†éœ€è¦äº’ç›¸ä¾èµ–ï¼Œæˆ–æ˜¯ä¸ºå®ƒä»¬è®¾è®¡å»ºç«‹ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†å™¨ã€‚
    
    **ååˆ†ç®€å•ï¼Œè½»é‡ï¼Œå’Œæ˜“äºå˜æ›´**ã€‚å½“ä¸€ä¸ª**Widget/æ¨¡å—**ä¸åœ¨éœ€è¦æ ¹æ®å¦ä¸€ä¸ª**Widget/æ¨¡å—**çš„å˜æ›´è€Œæ›´æ–°æ—¶ï¼Œåªéœ€ç§»é™¤å…¶ä¸­çš„**æ¥æ”¶å™¨**å³å¯ï¼Œè€Œä¸ç”¨ä¸ºæ­¤è€Œå¤§æ”¹**ä¾èµ–å…³ç³»**æˆ–æ˜¯**çŠ¶æ€ç®¡ç†å™¨**ã€‚


- **ç®€å•ã€çµæ´»ã€æ˜ç¡®ã€æ˜“ç®¡ç†**  

    **FBroadcast**  ä¸ºå¼€å‘è€…æä¾›äº†å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å‘é€å¹¿æ’­ï¼Œå’Œæ³¨å†Œ/ç§»é™¤æ¥æ”¶å™¨çš„èƒ½åŠ›ï¼Œæ¯«æ— çº¦æŸå’Œçµæ´»ã€‚
    
    å¹¿æ’­å’Œæ¥æ”¶å™¨ä¹‹é—´é€šè¿‡æ˜ç¡®çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰æ¥äº’ç›¸ç¡®è®¤èº«ä»½ï¼ŒæŒ‡å®šç±»å‹çš„å¹¿æ’­ï¼Œåªèƒ½è¢«æŒ‡å®šç±»å‹çš„æ¥æ”¶å™¨æ¥æ”¶ã€‚
    
    **FBroadcast** æä¾›äº†ç¯å¢ƒæ³¨å†Œæ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥åœ¨ç¯å¢ƒè§£æ„æ—¶ï¼Œé€šè¿‡ [unregister()] å‡½æ•°ä¸€æ¬¡æ€§ç§»é™¤ç¯å¢ƒä¸­çš„æ‰€æœ‰ç±»å‹æ¥æ”¶å™¨ï¼Œè€Œæ— éœ€è®°å¿†å’Œå…³å¿ƒç©¶ç«Ÿéœ€è¦ç§»é™¤é‚£äº›æ¥æ”¶å™¨ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ **Widget** çš„ `dispose()` ä¸­ï¼Œå°†æ³¨å†Œåœ¨è¯¥ **Widget** ä¸­çš„æ‰€æœ‰æ¥æ”¶å™¨ä¸€æ¬¡æ€§å…¨éƒ¨ç§»é™¤ã€‚
    
    å€ŸåŠ©ç°ä»£**IDEA**çš„èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥ä¸ºå¹¿æ’­ç³»ç»Ÿå»ºç«‹ä¸€å¼ ï¼ˆæˆ–å¤šå¼ ï¼‰ç»Ÿä¸€çš„å¹¿æ’­ç±»å‹ç´¢å¼•è¡¨ï¼Œé€šè¿‡**IDEA**çš„**å¼•ç”¨ç´¢å¼•**ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾çš„ã€ä¸€ç›®äº†ç„¶çš„çœ‹åˆ°è¯¥ç±»å‹çš„å¹¿æ’­åœ¨é‚£äº›åœ°æ–¹è¢«å‘é€è¿‡ï¼Œåœ¨é‚£äº›åœ°æ–¹æ³¨å†Œäº†æ¥æ”¶å™¨ï¼Œååˆ†æ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚è€Œä½¿ç”¨å­—ç¬¦ä¸²æ¥ä½œä¸ºç±»å‹æ ‡è¯†ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥å°†ä¸åŒç±»å‹çš„å¹¿æ’­å«ä¹‰æè¿°çš„è¶³å¤Ÿæ¸…æ™°æ˜ç™½ã€‚
    

- **ç²˜æ€§å¹¿æ’­æ”¯æŒ**
    
    **FBroadcast** æä¾›äº†å‘é€**ç²˜æ€§å¹¿æ’­**çš„æ”¯æŒã€‚åœ¨è¿˜æ²¡æœ‰æ³¨å†Œä»»ä½•æ¥æ”¶å™¨çš„æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé¢„å…ˆå‘é€ä¸€æ¡**ç²˜æ€§å¹¿æ’­**ã€‚**ç²˜æ€§å¹¿æ’­**ä¼šè¢«æš‚æ—¶æ»ç•™åœ¨å¹¿æ’­ç³»ç»Ÿä¸­ï¼Œå½“æœ‰æ¥æ”¶å™¨è¢«æ³¨å†Œæ—¶ï¼Œå³ä¼šç«‹å³å¹¿æ’­ã€‚è¿™æœ‰åŠ©äºå¸®åŠ©å¼€å‘è€…åœ¨åšé€»è¾‘è®¾è®¡æ—¶é‡‡å–æ›´æ¸…æ™°æœ‰æ•ˆçš„æ€è·¯ã€‚
    
    ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ§åˆ¶æ¨¡å—ä¸­çš„å¼€å…³æŒ‰é’®è¢«æ‰“å¼€ï¼Œè€Œæ­¤æ—¶å¼€å…³æ‰€æ§åˆ¶çš„æ¨¡å—è¿˜æ²¡æœ‰è¢«æ„å»ºï¼Œå°±å¯ä»¥å…ˆå‘é€ä¸€æ¡**ç²˜æ€§å¹¿æ’­**ï¼Œåœ¨æ¨¡å—è¢«æ„å»ºå®Œæˆæ³¨å†Œäº†æ¥æ”¶å™¨åï¼Œå°±ä¼šç«‹å³æ¥æ”¶åˆ°**ç²˜æ€§å¹¿æ’­**è€Œè¿›å…¥å¼€å¯çŠ¶æ€ï¼ˆè¿™ä¸äº’ç›¸ä¾èµ–ã€å®šä¹‰ç»Ÿä¸€çŠ¶æ€ç®¡ç†æˆ–æ˜¯å‚æ•°ä¼ é€’ï¼Œç„¶åæ£€æŸ¥å¼€å…³çŠ¶æ€çš„æ€è·¯æœ‰æœ¬è´¨åŒºåˆ«ï¼‰ã€‚


# ğŸ“¡ è¿™çœŸä¸æ˜¯ä¸€èˆ¬çš„ Broadcast

## ğŸ›  Base Broadcast

> é€šä¿¡å°±è¦ç®€å•ï¼Œæ˜ç¡®

é€šè¿‡ **FBroadcast** æ¥æ³¨å†Œï¼Œå‘é€å¹¿æ’­éå¸¸ç®€ä¾¿ã€‚

```dart
/// æ³¨å†Œæ¥æ”¶å™¨
/// 
/// register
FBroadcast.instance().register(Key_Message, (value, callback) {
  /// do something
});

/// å‘é€æ¶ˆæ¯
/// 
/// send message
FBroadcast.instance().broadcast(Key_Message);
```

**FBroadcast** å…è®¸å¼€å‘è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¸¦æœ‰æ•°æ®ã€‚

```dart
/// æ³¨å†Œæ¥æ”¶å™¨
/// 
/// register
FBroadcast.instance().register(Key_Message, (value, callback) {
  /// è·å–æ•°æ®
  /// 
  /// get data
  var data = value;
});

/// å‘é€æ¶ˆæ¯å’Œæ•°æ®
/// 
/// send message and data
FBroadcast.instance().broadcast(
  /// æ¶ˆæ¯ç±»å‹
  /// 
  /// message type
  Key_Message, 

  /// æ•°æ®
  /// 
  /// data
  value: data,
);
```

å¼€å‘è€…å¯ä»¥é€‰æ‹©å°†ç‰¹å®šç±»å‹çš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™æ ·å°±èƒ½è½»æ˜“å®ç°å¹¿æ’­å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†ã€‚

```dart
FBroadcast.instance().broadcast(
  /// æ¶ˆæ¯ç±»å‹
  /// 
  /// message type
  Key_Message, 

  /// æ•°æ®
  /// 
  /// data
  value: data, 

  /// å°†æ¶ˆæ¯ç±»å‹æŒä¹…åŒ–
  /// 
  /// Persist the message types
  persistence: true,
);
```

å½“å¼€å‘è€…å°†ä¸€ä¸ªæ¶ˆæ¯ç±»å‹æŒä¹…åŒ–åï¼Œå°±å¯ä»¥åœ¨ä»»æ„ä½ç½®ï¼Œé€šè¿‡ `FBroadcast.value(String key)` æ¥è·å–å¹¿æ’­ç³»ç»Ÿä¸­è¯¥ç±»å‹æ¶ˆæ¯çš„æœ€æ–°çš„æ•°æ®ã€‚è€Œæ›´æ–°å¹¿æ’­ç³»ç»Ÿä¸­çš„æ•°æ®åªéœ€è¦é€šè¿‡ `broadcast()` å³å¯å®Œæˆã€‚

> âš ï¸æ³¨æ„ï¼Œä¸€ä¸ªæ¶ˆæ¯ç±»å‹ä¸€æ—¦æŒä¹…åŒ–å°±åªèƒ½é€šè¿‡ `FBroadcast.instance().clear(String key)` æ¥ä»å¹¿æ’­ç³»ç»Ÿä¸­ç§»é™¤è¯¥ç±»å‹çš„æ¶ˆæ¯ã€‚

## ğŸ§² Sticky Broadcast

> æ›´å¤šçš„é€‰æ‹©ï¼Œæ„å»ºæ›´ç²¾ç¾çš„åº”ç”¨

**FBroadcast** æ”¯æŒå¼€å‘è€…å‘é€**ç²˜æ€§å¹¿æ’­**ã€‚

```dart
FBroadcast.instance().stickyBroadcast(
  /// æ¶ˆæ¯ç±»å‹
  /// 
  /// message type
  Key_Message, 

  /// æ•°æ®
  /// 
  /// data
  value: data, 
);
```

å½“å¹¿æ’­ç³»ç»Ÿä¸­æ²¡æœ‰å¯¹åº”ç±»å‹çš„æ¥æ”¶å™¨æ—¶ï¼Œ**ç²˜æ€§å¹¿æ’­** å°†ä¼šæš‚æ—¶æ»ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œç›´åˆ°æœ‰è¯¥ç±»å‹çš„æ¥æ”¶å™¨è¢«æ³¨å†Œï¼Œåˆ™ä¼šç«‹å³å‘å‡ºå¹¿æ’­ï¼ˆå½“å¹¿æ’­ç³»ç»Ÿä¸­æœ‰å¯¹åº”ç±»å‹çš„æ¥æ”¶å™¨æ—¶ï¼Œå°±å’Œæ™®é€šå¹¿æ’­å…·æœ‰ç›¸åŒçš„è¡¨ç°ï¼‰ã€‚

## â›“ Two-way communication

> åŒå‘æ²Ÿé€šï¼ŒåŒå€æ•ˆç‡

**FBroadcast** æ”¯æŒåœ¨å¹¿æ’­å‘é€ç‚¹æ¥æ”¶**æ¥æ”¶å™¨**è¿”å›çš„æ¶ˆæ¯ã€‚

```dart
/// å‘é€æ¶ˆæ¯
/// 
/// send message
FBroadcast.instance().broadcast(
  /// æ¶ˆæ¯ç±»å‹
  /// 
  /// message type
  Key_Message, 

  /// æ•°æ®
  /// 
  /// data
  value: data, 
  
  /// æ¥æ”¶å™¨è¿”å›çš„æ¶ˆæ¯
  /// 
  /// The message returned by the receiver
  callback: (value){
    // do something
  }
);


/// æ³¨å†Œæ¥æ”¶å™¨
/// 
/// register
FBroadcast.instance().register(Key_Message, (value, callback) {
  /// è·å–æ•°æ®
  /// 
  /// get data
  var data = value;

  /// do something
  var result = logic();

  /// è¿”å›æ¶ˆæ¯
  /// 
  /// return message
  callback(result);
});
```

é€šè¿‡ **FBroadcast** èƒ½å¤Ÿç»™ååˆ†è½»æ¾çš„å®ç°åŒå‘é€šä¿¡ã€‚

## ğŸŒ Bind Context

> ä¸€ç å¸è½½ï¼Œå¿«æ·ç²¾å‡†

**FBroadcast** æ”¯æŒåœ¨æ³¨å†Œæ¥æ”¶å™¨æ—¶ä¼ å…¥ä¸€ä¸ª**ç¯å¢ƒå¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼‰**ï¼Œè¿™ä¼šå°†æ¥æ”¶å™¨æ³¨å†Œåˆ°ç¯å¢ƒä¸­ï¼Œå½“ç¯å¢ƒè§£æ„æ—¶ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿çš„ä¸€æ¬¡æ€§ç§»é™¤æ‰€æœ‰åœ¨è¯¥ç¯å¢ƒä¸­æ³¨å†Œçš„æ¥æ”¶å™¨ã€‚

```dart
/// æ³¨å†Œæ¥æ”¶å™¨
/// 
/// register
FBroadcast.instance().register(
  /// æ¶ˆæ¯ç±»å‹
  /// 
  /// Message type
  Key_Message1,

  /// Receiver
  ///
  /// Receiver
  (value, callback) {
    /// do something
  },

  /// æ›´å¤šæ¥æ”¶å™¨
  /// 
  /// more receiver
  more: {
    /// æ¶ˆæ¯ç±»å‹ï¼š æ¥æ”¶å™¨
    /// 
    /// Message type: Receiver
    Key_Message2: (value, callback) {
      /// do something
    },
    Key_Message3: (value, callback) {
      /// do something
    },
    Key_Message4: (value, callback) {
      /// do something
    },
  },

  /// ç¯å¢ƒå¯¹è±¡
  /// 
  /// context
  context: this,
);

/// ç§»é™¤ç¯å¢ƒä¸­çš„æ‰€æœ‰æ¥æ”¶å™¨
/// 
/// Remove all receivers from the environment
FBroadcast.instance().unregister(this);
```

# ğŸ‘€ ä½¿ç”¨ FBroadcast å¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ

## ğŸ’« æ¶ˆæ¯ä¼ é€’

> **åœºæ™¯**ï¼šç‚¹å‡» **Start**ï¼ŒRunner å¼€å§‹ Runï¼Œæ˜¾ç¤ºå±éœ€è¦å®æ—¶æ›´æ–°è¿åŠ¨å‘˜çš„çŠ¶æ€ã€‚

![](https://gw.alicdn.com/tfs/TB1ZgoHg_M11u4jSZPxXXahcXXa-1280-869.gif)

### ğŸƒ 1. åˆ›å»º Runner: 
```dart
/// Runner
class Runner {
  Runner() {
    /// register
    FBroadcast.instance().register(Key_RunnerState, (value, callback) {
      if (value is String && value.contains("Run")) {
        /// receive start run message
        FBroadcast.instance().broadcast(Key_RunnerState, value: "0m..");
        run(20);
      }
    });
  }

  run(double distance) {
    /// send running message
    Timer(Duration(milliseconds: 500), () {
      FBroadcast.instance().broadcast(Key_RunnerState, value: "${distance.toInt()}m..");
      var newDistance = distance + 20;
      if (newDistance > 100) {
        FBroadcast.instance().broadcast(Key_RunnerState, value: "Win!\nTotal time is 2.5s");
      } else {
        run(newDistance);
      }
    });
  }
}
```

### ğŸ­ 2. åˆ›å»º UI:

```dart
Column(
  mainAxisAlignment: MainAxisAlignment.center,
  children: <Widget>[
    Stateful(
      /// init
      initState: (setState, data) {
        FBroadcast.instance().register(
          Key_RunnerState,
          (value, callback) {
            /// refresh ui
            setState(() {});
          },
          /// bind context
          context: data,
        );
      },
      builder: (context, setState, data) {
        return FSuper(
          ...
          /// get running message
          text: FBroadcast.value(Key_RunnerState) ?? "Preparing..",
        );
      },
    ),
    const SizedBox(height: 100),
    FButton(
      text: "Start"
      ...
      onPressed: () {
        /// send start run message
        FBroadcast.instance().broadcast(Key_RunnerState, value: "Running...");
      },
    ),
  ],
)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ **FBroadcast** ç®€å•æ¸…æ™°çš„å®ç°äº† Runner å’Œ UI ä¹‹é—´çš„é€šä¿¡ã€‚
  
> 1. ç‚¹å‡» Start æŒ‰é’®ï¼Œé€šè¿‡ **FBroadcast** å‘é€èµ·è·‘æ¶ˆæ¯ç»™ Runnerï¼›

> 2. Runner æ”¶åˆ°æ¶ˆæ¯åï¼Œå¼€å§‹ Runï¼ŒåŒæ—¶ä¸æ–­é€šè¿‡ **FBroadcast** å‘å‡º Running infoï¼›

> 3. UI ç”±äºæ³¨å†Œäº†æ¥æ”¶å™¨ï¼Œåœ¨æ¥æ”¶åˆ° Running info æ—¶ï¼Œé€šè¿‡ `FBroadcast.value()` è·å–æ¶ˆæ¯æ•°æ®ï¼Œè‡ªåŠ¨æ›´æ–°è§†å›¾ã€‚

æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRunner å’Œ UI ä¹‹é—´æ˜¯**å®Œå…¨è§£è€¦**çš„ï¼Œä¸” UI åªéœ€åœ¨ `init` ä¸­**æ³¨å†Œæ¥æ”¶å™¨**ï¼ˆreceiver ä¸­è°ƒç”¨ `setState((){})`ï¼‰ï¼Œå°±èƒ½æ ¹æ®æ¶ˆæ¯æ•°æ®çš„å˜åŒ–ï¼Œè‡ªåŠ¨å®æ—¶çš„æ›´æ–°è§†å›¾ï¼Œè€Œæ— éœ€å¼€å‘è€…å…³å¿ƒæ•´ä¸ªè¿‡ç¨‹ã€‚

## â›“ åŒå‘é€šä¿¡

> **åœºæ™¯**ï¼šç‚¹å‡»æŒ‰é’®è¯·æ±‚å®šä½ï¼Œå®šä½æˆåŠŸåæ¥æ”¶ç»“æœï¼Œåˆ·æ–°å®šä½ç‚¹

![](https://gw.alicdn.com/tfs/TB18D6vQ.Y1gK0jSZFMXXaWcVXa-1280-951.gif)

### ğŸ“ 1. å…¨å±€å®šä½æœåŠ¡æä¾›å•†

```dart
class LocationServer {
  LocationServer() {
    init();
  }

  init() {
    /// register Key_Location receiver
    FBroadcast.instance().register(Key_Location, (value, callback) async {
      var loc = await location();

      /// return message
      callback(loc);
    });
  }

  /// Analog positioning
  Future<List<double>> location() async {
    await Future.delayed(Duration(milliseconds: 2000));
    return [Random().nextDouble() * 280, Random().nextDouble() * 150];
  }
}

```

### ğŸ“ 2. ç‚¹å‡»å‘é€å®šä½è¯·æ±‚ï¼Œæ¥æ”¶è¿”å›æ¶ˆæ¯


```dart

FButton(
  ...
  text: "Location",
  onPressed: () {
    FLoading.show(context,
        color: Colors.black26, loading: buildLoading());
    /// request location
    FBroadcast.instance().broadcast(Key_Location,
        callback: (location) {
      /// The message returned by the receiver
      setState(() {
        FLoading.hide();
        this.location = location;
      });
    });
  },
)

```

**FBroadcast** èƒ½å¤Ÿè¿›ä¸€æ­¥ç®€åŒ–éœ€è¦åŒå‘é€šä¿¡çš„åœºæ™¯ã€‚å¼€å‘è€…å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ **FBroadcast** èƒ½å¤Ÿè½»æ¾çš„å®ç°å®šä½è¯·æ±‚è¿™ç§åŒå‘é€šä¿¡çš„åœºæ™¯ï¼Œè€Œä¸”ä½¿å¾—**å®šä½æœåŠ¡æä¾›å•†**å’Œ**UI**å®ç°çš„å®Œå…¨çš„è§£è€¦ã€‚

**UIäº¤äº’ç‚¹**åªéœ€è¦å‘é€å®šä½è¯·æ±‚çš„å¹¿æ’­ï¼Œä»»ä½•æ³¨å†Œè¯¥å¹¿æ’­çš„**å®šä½æœåŠ¡æä¾›å•†**å°±å¯ä»¥æ¥æ”¶è¯¥è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›ç»“æœåˆ°**UIäº¤äº’ç‚¹**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéšç€é¡¹ç›®çš„æ¼”è¿›ï¼Œå¼€å‘è€…å¯ä»¥éšæ—¶æä¾›æ–°çš„**å®šä½æœåŠ¡æä¾›å•†**ï¼Œè€Œæ— éœ€å…³å¿ƒä»»ä½•çš„**UI**å˜æ›´ã€‚

## ğŸ“± å±€éƒ¨çŠ¶æ€ç®¡ç†


> **åœºæ™¯**ï¼šç‚¹å‡»æ”¹å˜UIé¢œè‰²

![](https://gw.alicdn.com/tfs/TB1jDjHQUY1gK0jSZFCXXcwqXXa-1280-869.gif)

### ğŸ“ 1. ç‚¹å‡»å‘å‡ºäº‹ä»¶

```dart
FButton(
  text: "Change Color",
  ...
  onPressed: () {
    /// send change color message
    FBroadcast.instance().broadcast(Key_Color, value: reduceColor());
  },
)
```

### ğŸ“ 2. UI æ³¨å†Œæ¥æ”¶å™¨

```dart
Stateful(
  /// init
  initState: (setState, data) {
    /// register
    FBroadcast.instance().register(
      Key_Color,
      (value, callback) {
        /// refresh ui
        setState(() {
        });
      },
      /// bind context
      context: data,
    );
  },
  builder: (context, setState, data) {
    return FSuper(
      ...
      /// get color value
      backgroundColor: FBroadcast.value<Color>(Key_Color) ?? mainBackgroundColor,
    );
  },
)
```

é€šè¿‡ **FBroadcast** å¯ä»¥å¾ˆè½»æ˜“çš„å®Œæˆ UI äº¤äº’ä¹‹é—´çš„å±€éƒ¨çŠ¶æ€æ›´æ–°ã€‚ä¸Šé¢çš„ç¤ºä¾‹å±•ç¤ºäº†é¢œè‰²çš„å˜æ›´ï¼Œæ•°æ®å¯¹è±¡åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦å°†é€šä¿¡çš„æ•°æ®å¯¹è±¡è¿›è¡Œä¸°å¯Œæ‰©å±•ã€‚

å¼€å‘è€…åªéœ€è¦åœ¨éœ€è¦æ›´æ–° UI çš„ Widget ä¸­**æ³¨å†Œæ¥æ”¶å™¨**ï¼Œè°ƒç”¨ä¸€æ¬¡ `setState((){})`ï¼Œåœ¨äº¤äº’ç‚¹å‘å‡ºæ¶ˆæ¯ã€‚è€Œä¸ç”¨å»ä¸»åŠ¨çš„å°†è§¦å‘é€»è¾‘å’Œ `setState((){})` åœ¨æ‰€æœ‰çš„äº¤äº’ç‚¹éƒ½å†™ä¸€æ¬¡ã€‚


## ğŸ’» å…¨å±€çŠ¶æ€ç®¡ç†

> **åœºæ™¯**ï¼šç‚¹å‡»å¤´åƒè·³è½¬ç™»é™†é¡µï¼Œå½“è´¦å·å¯†ç ä¸ä¸º null æ—¶ï¼Œç™»é™†æŒ‰é’®æ‰å¯ä»¥ç‚¹å‡»ã€‚ç‚¹å‡»ç™»é™†æŒ‰é’®å‘é€ç™»é™†è¯·æ±‚ï¼Œç™»é™†æˆåŠŸåï¼Œè¿”å›ä¸Šä¸€é¡µï¼Œåˆ·æ–°ç”¨æˆ·ä¿¡æ¯ã€‚

![](https://gw.alicdn.com/tfs/TB1kOvGQKH2gK0jSZJnXXaT1FXa-1280-869.gif)

### ğŸ“ 1. ç”¨æˆ·ä¿¡æ¯Widgetæ³¨å†Œæ¥æ”¶å™¨

```dart
class Avatar extends StatefulWidget {
  @override
  _AvatarState createState() => _AvatarState();
}

class _AvatarState extends State<Avatar> {

  User user;
  int msgCount = 0;
  @override
  void initState() {
    super.initState();
    FBroadcast.instance().register(
      Key_MsgCount,
      /// register Key_MsgCount reviver
      (value, callback) => setState(() {
        msgCount = value;
      }),
      more: {
        /// register Key_User reviver
        Key_User: (value, callback) => setState(() {
          /// get value
          user = value;
        }),
      },
      /// bind context
      context: this,
    );
  }

  @override
  Widget build(BuildContext context) {
    return FSuper(
      ...
      backgroundImage: (user == null || _textIsEmpty(user.avatar)) ? null : AssetImage(user.avatar),
      redPoint: user != null && msgCount > 0,
      redPointText: msgCount.toString(),
      text: user != null ? null : "Click Login",
      onClick: user != null
          ? null
          : () => Navigator.push(context, MaterialPageRoute( builder: (context) => LoginPage())),
    );
  }

  @override
  void dispose() {
    super.dispose();
    /// remove all receivers from the environment
    FBroadcast.instance().unregister(this);
  }
}
```

ç™»é™†é¡µä¸­æ³¨å†Œ `Key_User` æ¥æ”¶å™¨ï¼Œå½“æ¥æ”¶åˆ°ç™»é™†æ¶ˆæ¯æ—¶ï¼Œå–å‡ºå…¶ä¸­çš„æ•°æ®ï¼Œåˆ·æ–°UIã€‚

### ğŸ“ 2. æ„å»ºæ•°æ®æ¨¡å‹

```dart
class User{
  String name;
  String avatar;
  int messageCount = 0;
  String info;
}
```

### ğŸ“ 3. æ„å»ºé€»è¾‘å¤„ç†å¯¹è±¡

```dart
class LoginHandler {
  String _userName;
  String _password;

  /// set user name, check to see if login is allowed
  set userName(String v) {
    _userName = v;
    if (_textNoEmpty(_userName) && _textNoEmpty(_password)) {
      FBroadcast.instance().broadcast(Key_Login, value: true);
    } else {
      FBroadcast.instance().broadcast(Key_Login, value: false);
    }
  }

  /// set user password, check to see if login is allowed
  set password(String v) {
    _password = v;
    if (_textNoEmpty(_userName) && _textNoEmpty(_password)) {
      FBroadcast.instance().broadcast(Key_Login, value: true);
    } else {
      FBroadcast.instance().broadcast(Key_Login, value: false);
    }
  }

  /// login
  void login() {
    Timer(Duration(milliseconds: 1500), () {
      /// login successï¼Œsend login success message â€”â€” Key_User
      FBroadcast.instance().broadcast(
        Key_User,
        value: User()
          ..avatar = "assets/logo.png"
          ..name = _userName
          ..info =
              "Seriously provide exquisite widget to help you build exquisite application.",
        /// Persistence Key_User
        persistence: true,
      );
    });
  }
}
```

å°†é€»è¾‘å¤„ç†è½¬ç§»åˆ° **LoginHandler** ä¸­è¿›è¡Œéš”ç¦»ï¼Œæ‰€æœ‰çš„å¤„ç†ç»“æœéƒ½é€šè¿‡ **FBroadcast** å¹¿æ’­å‡ºå»ï¼Œä½¿æ³¨å†Œåˆ°å¹¿æ’­ç³»ç»Ÿä¸­çš„å¯¹åº”æ¥æ”¶å™¨èƒ½å¤Ÿå“åº”ã€‚

### ğŸ“ 4. ç™»é™†é¡µ

```dart
class LoginPage extends StatefulWidget {
  @override
  _LoginPageState createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  /// Logic handler
  LoginHandler handler = LoginHandler();
  /// input controller
  FSearchController _controller1 = FSearchController();
  FSearchController _controller2 = FSearchController();

  @override
  void initState() {
    super.initState();
    _controller1.setListener(() {
      /// update userName
      handler.userName = _controller1.text;
    });
    _controller2.setListener(() {
      /// update password
      handler.password = _controller2.text;
    });
  }

  @override
  Widget build(BuildContext context) {
    return {
      ...
      /// userName input
      FSearch(
        controller: _controller1,
        ...
      ),
      ...
      /// userName input
      FSearch(
        controller: _controller2,
        ...
      ),
      ...
      Stateful(
        initState: (setState, data) {
          /// register login receiver
          FBroadcast.instance().register(
            Key_Login,
            /// refresh ui
            (value, callback) => setState(() {}),
            more: {
              /// register user receiver
              Key_User: (value, callback) {
                FLoading.hide();
                Navigator.pop(context);
              },
            },
            /// bind context
            context: data,
          );
        }, 
        builder: (context, setState, data) {
          return FButton(
            ...
            text: "LOGIN",
            /// Key_Login value=true is allowed to click login
            onPressed: !(FBroadcast.value(Key_Login) ?? false)
                ? null
                : () {
                    _controller1.clearFocus();
                    _controller2.clearFocus();
                    FLoading.show(context);
                    /// Execute login logic
                    handler.login();
                  },
          );
      },),
      ...
    };
  }
}
```

æ³¨å†Œæ¥æ”¶å™¨æ—¶ï¼Œåªéœ€åœ¨æ¥æ”¶å›è°ƒä¸­è°ƒç”¨ `setState((){})`ï¼Œåç»­æ‰€æœ‰çš„æ•°æ®å˜åŒ–åˆ·æ–°ï¼Œå¼€å‘è€…å°±å¯ä»¥ä¸ç”¨å…³æ³¨äº†ã€‚è€Œç»™ UI èµ‹å€¼å¯ä»¥æ–¹ä¾¿çš„é€šè¿‡ **FBroadcast.value()** è·å–å¯¹åº”æ•°æ®æ¥è¿›è¡Œã€‚

> âš ï¸æ³¨æ„ï¼Œå¯¹äºéœ€è¦å…¨å±€ä½¿ç”¨çš„çŠ¶æ€/æ•°æ®æ¨¡å‹ï¼Œå®ƒä»¬å¯¹åº”çš„å¹¿æ’­ç±»å‹ï¼Œåœ¨å‘é€æ—¶ï¼Œ**éœ€è¦è‡³å°‘æœ‰ä¸€æ¬¡å°† persistence** è®¾ç½®ä¸º **true**ã€‚ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå°±åœ¨ç™»é™†æˆåŠŸåï¼Œå¯¹ `Key_User` ç±»å‹çš„å¹¿æ’­è¿›è¡Œäº†æŒä¹…åŒ–ã€‚

```dart
/// login successï¼Œsend login success message â€”â€” Key_User
FBroadcast.instance().broadcast(
  Key_User,
  value: User()
    ..avatar = "assets/logo.png"
    ..name = _userName
    ..info =
        "Seriously provide exquisite widget to help you build exquisite application.",
  /// Persistence Key_User
  persistence: true,
);
```

ä¸Šé¢çš„ç¤ºä¾‹ä¸­å±•ç¤ºäº†é€šè¿‡ **FBroadcast** å¯ä»¥è½»æ¾å¿«é€Ÿçš„å®ç°**æ¶ˆæ¯ä¼ é€’**ï¼Œè¿›è¡Œ **å±€éƒ¨ã€å…¨å±€çŠ¶æ€ç®¡ç†å’Œåˆ·æ–°**ï¼Œå¾ˆå¥½çš„å°†**å„ä¸ªæ¨¡å—ï¼Œé€»è¾‘ä»¥åŠUI** è¿›è¡Œè§£è€¦ã€‚**FBroadcast** æä¾›äº†ç®€æ´æ˜“æ‡‚ï¼Œè€Œä¸”ååˆ†çµæ´»çš„å¹¿æ’­ç³»ç»Ÿï¼Œæå°‘çš„æŸç¼šè®©å¼€å‘è€…å¯ä»¥å¿«é€Ÿä¸Šæ‰‹ï¼Œè½»æ¾å®ç°å¤æ‚é€»è¾‘çš„ç®€åŒ–ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå‡º**æ˜“äºç»´æŠ¤çš„ã€å¤æ‚çš„ã€ç²¾ç¾çš„**åº”ç”¨ã€‚

**FBroadcast** åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé…åˆç»Ÿä¸€çš„**å¹¿æ’­ç±»å‹æ³¨å†Œè¡¨**ï¼ˆä¹Ÿå¯ä»¥æŒ‰æ¨¡å—åˆ†å¤šå¼ ï¼‰ï¼Œå¼€å‘è€…å¯ä»¥å¾ˆè½»æ˜“çš„å€ŸåŠ© **IDEA** çš„å¼•ç”¨æ£€ç´¢èƒ½åŠ›ï¼Œéšæ—¶æŸ¥çœ‹æ‰€æœ‰å¹¿æ’­çš„æƒ…å†µï¼Œå¯¹äºä¸æ–­è¿­ä»£è¿‡ç¨‹ä¸­çš„ç»´æŠ¤ååˆ†æœ‰ç›Šã€‚

![](https://gw.alicdn.com/tfs/TB1eg6tdQcx_u4jSZFlXXXnUFXa-1280-442.gif)


### [æƒ³è¦äº†è§£æ›´å¤šè¯¦ç»†å†…å®¹ï¼Ÿè¯·è®¿é—® **FBroadcast** å®˜æ–¹ä¸»é¡µ (PSï¼šåˆ«å¿˜äº†æŠ•å‡ºä¸€ä¸ªä½ è®¤å¯çš„ **Star** å“¦ ğŸ˜˜)ã€‚](https://github.com/Fliggy-Mobile/fbroadcast)

# ğŸ˜ƒ å¦‚ä½•ä½¿ç”¨ï¼Ÿ

åœ¨é¡¹ç›® `pubspec.yaml` æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š

## ğŸŒ pub ä¾èµ–æ–¹å¼

```
dependencies:
  fbroadcast: ^<ç‰ˆæœ¬å·>
```

> âš ï¸ æ³¨æ„ï¼Œè¯·åˆ° [**pub**](https://pub.dev/packages/fbroadcast) è·å– **FBroadcast** æœ€æ–°ç‰ˆæœ¬å·

## ğŸ–¥ git ä¾èµ–æ–¹å¼

```
dependencies:
  fbroadcast:
    git:
      url: 'git@github.com:Fliggy-Mobile/fbroadcast.git'
      ref: '<åˆ†æ”¯å· æˆ– tag>'
```

> âš ï¸ æ³¨æ„ï¼Œåˆ†æ”¯å· æˆ– tag è¯·ä»¥ [**FBroadcast**](https://github.com/Fliggy-Mobile/fbroadcast) å®˜æ–¹é¡¹ç›®ä¸ºå‡†ã€‚


[![](https://gw.alicdn.com/tfs/TB1Zn2BGUT1gK0jSZFrXXcNCXXa-320-289.png)](https://github.com/Fliggy-Mobile/fbroadcast)

#### [æ„Ÿè§‰è¿˜ä¸é”™ï¼Ÿè¯·åˆ° ã€ŠFBroadcastã€‹çš„ Github ä¸»é¡µæŠ•å‡ºæ‚¨è®¤å¯çš„ä¸€ä¸ª Star ğŸŒŸ å§ï¼](https://github.com/Fliggy-Mobile/fbroadcast)

# æ›´å¤šç²¾å½©ç»„ä»¶

- [ã€ŠFSuperã€‹- å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºç²¾ç¾çš„å¤æ‚è§†å›¾](https://github.com/Fliggy-Mobile/fsuper)

- [ã€ŠFButtonã€‹- ä¸ºå¼€å‘è€…å‡†å¤‡äº†è¯¸å¤šç¾å¦™çš„é…ç½®é¡¹](https://github.com/Fliggy-Mobile/fbutton)

- [ã€ŠFSwitchã€‹- å…·æœ‰ä¼˜è‰¯äº¤äº’å’Œè§†æ•ˆçš„ç²¾ç¾å¼€å…³å…ƒç´ ](https://github.com/Fliggy-Mobile/fswitch)

- [ã€ŠFRadioã€‹- ä¸€ä¸ªé€‚ç”¨äºå‡ ä¹ä»»æ„å•é€‰åœºæ™¯çš„å•é€‰ç»„ä»¶](https://github.com/Fliggy-Mobile/fradio)

- [ã€ŠFFloatã€‹- æ»¡è¶³ä½ å¯¹æµ®åŠ¨å…ƒç´ çš„ä¸€åˆ‡æƒ³è±¡](https://github.com/Fliggy-Mobile/ffloat)

- [ã€ŠFRefreshã€‹- è½»æ¾æ„å»ºä¸‹æ‹‰åˆ·æ–°æ•ˆæœ](https://github.com/Fliggy-Mobile/frefresh)

- [ã€ŠFDottedLineã€‹- è¾‰ç…Œçš„è™šçº¿æ•ˆæœ](https://github.com/Fliggy-Mobile/fdottedline)

- [ã€ŠFSearchã€‹- ä¸€åº”ä¿±å…¨çš„æœç´¢æ¡†ç»„ä»¶](https://github.com/Fliggy-Mobile/fsearch)

- [ã€ŠFToastã€‹- ç²¾è‡´çµæ´»çš„ **Flutter** åŸç”Ÿ **Toast** ç»„ä»¶](https://github.com/Fliggy-Mobile/ftoast)

- [ã€ŠFLoadingã€‹- å¸®åŠ©å¼€å‘è€…è‡ªç”±çš„ä½¿ç”¨ Loading](https://github.com/Fliggy-Mobile/floading)

