[![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/Flutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—å°é¢2.JPG)](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)

[**ç›®å½•ä¼ é€é—¨ï¼š**ã€ŠFlutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—ã€‹å…ˆå¯¼ç¯‡](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)

åœ¨ Flutter ä¸­ï¼Œæœ‰ä¸¤ç±»å¸¸ç”¨çš„ Widgetï¼š
  
-   æ— çŠ¶æ€çš„ **StatelessWidget**
  
  
- æœ‰çŠ¶æ€çš„ **StatefulWidget**

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ç»§æ‰¿å®ƒä»¬ä¸¤æ¥å®ç°è‡ªå·±çš„ Widgetã€‚


# 1. StatelessWidget

ä¸€ä¸ª StatelessWidget æ˜¯ä¸èƒ½è¢«æ”¹å˜çš„ï¼Œæ¯”å¦‚ï¼š`Icon`ã€`Text`ç­‰ã€‚

å¦‚æœä½ çš„æ§ä»¶ä¸€æ—¦æ˜¾ç¤ºï¼Œå°±ä¸éœ€è¦å†åšä»»ä½•çš„å˜æ›´ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨ **StatelessWidget**ã€‚

å®ç°ä¸€ä¸ªè‡ªå·±çš„ StatelessWidget å¾ˆç®€å•ã€‚

å½“ä½ çœ‹åˆ°ä¸‹é¢è¿™ä¸ªä¾‹å­ğŸŒ°æ—¶ï¼Œä½ å°±çŸ¥é“å®ƒæœ‰å¤šç®€å•äº†ã€‚

```
class MyWidget extends StatelessWidget {

  @override
  Widget build(BuildContext context) {
    return _buildMyWidget(context);
  }
```

çœ‹ï¼Œåªè¦åœ¨ `build()` ä¸­è¿”å›ä½ çš„è§†å›¾å°±å¯ä»¥äº†ã€‚

# 2. StatefulWidget

ä¸€ä¸ª **StatefulWidget** æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¯å˜çš„ã€‚

å®ƒå¯ä»¥æ”¹å˜è‡ªå·±çš„å¤–è§‚ï¼Œä»¥å“åº”ç”¨æˆ·çš„æ“ä½œæˆ–è€…æ•°æ®çš„å˜åŒ–ã€‚

æ¯”å¦‚ï¼š`CheckBox`ã€`Switch`..

æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ”¹å˜ä¸€ä¸ª **StatefulWidget**ï¼Œæ˜¯å› ä¸ºå®ƒæœ‰ä¸€ä¸ªè®¾ç½®çŠ¶æ€çš„å‡½æ•°ï¼š  

```
setState((){
    // æ›´æ–°çŠ¶æ€ã€æ•°æ®
})
```

è°ƒç”¨è¿™ä¸ªå‡½æ•°åï¼Œå°±ä¼šè§¦å‘ **StatefulWidget** çš„è§†å›¾æ ‘é‡å»ºã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯äº¤äº’çš„ï¼Œå³èƒ½æ ¹æ®ç”¨æˆ·æ“ä½œæˆ–æ•°æ®å˜åŒ–è€Œæ”¹å˜è§†å›¾çš„ Widget
æ—¶ï¼Œé‚£å°±å¾—ç”¨ä¸Š StatelessWidget äº†ã€‚

## 2.1 è‡ªå®šä¹‰ StatefulWidget

ç°åœ¨ï¼Œæ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ StatefulWidgetï¼š



1. å®ç°ä¸€ä¸ª **StatefulWidget**ï¼Œå®ƒæ˜¯ Widget çš„å¤–å±‚ã€‚
    
    
    ```
    class FavoriteStatefulWidget extends StatefulWidget {
    
      // å¿…é¡»é‡å†™ createState()ï¼Œè¿”å›ä¸€ä¸ª Stateï¼Œå®ƒåŒ…å«äº†è§†å›¾å’Œäº¤äº’é€»è¾‘
      @override
      State<StatefulWidget> createState() => _FavoriteStatefulWidgetState();
    }
    ```


2. å®ç°ä¸€ä¸ª **State**ï¼Œå®ƒæä¾›äº†çœŸæ­£çš„ Widget è§†å›¾å’Œäº¤äº’é€»è¾‘ã€‚  
    
    ```
    class _FavoriteStatefulWidgetState extends State<FavoriteStatefulWidget> {
      bool _isFavorited = true;
      int _favoriteCount = 41;
    
      void _toggleFavorite() {
        // é€šè¿‡ setState() æ›´æ–°æ•°æ®
        // ç»„ä»¶æ ‘å°±ä¼šè‡ªåŠ¨åˆ·æ–°äº†
        setState(() {
          if (_isFavorited) {
            _favoriteCount -= 1;
            _isFavorited = false;
          } else {
            _favoriteCount += 1;
            _isFavorited = true;
          }
        });
      }
    
      // é‡å†™ build() å‡½æ•°ï¼Œæ„å»ºè§†å›¾æ ‘
      @override
      Widget build(BuildContext context) => Row(
            mainAxisSize: MainAxisSize.min,
            children: [
              Container(
                padding: EdgeInsets.all(0),
                child: IconButton(
                  icon: (_isFavorited ? Icon(Icons.star) : Icon(Icons.star_border)),
                  color: Colors.red[500],
                  onPressed: _toggleFavorite,
                ),
              ),
              SizedBox(
                width: 18,
                child: Container(
                  child: Text('$_favoriteCount'),
                ),
              ),
            ],
          );
    }
    ```


3. ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„ StatefulWidget çœ‹çœ‹æ•ˆæœã€‚
    
    ```
    main() => runApp(MaterialApp(
          title: 'Flutter Demo',
          home: Scaffold(
            appBar: AppBar(
              title: Text('Flutter Demo'),
            ),
            body: Container(
              color: Colors.white,
              child: Center(
                child: FavoriteStatefulWidget(),
              ),
            ),
          ),
        ));
    ```  
    
    ![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/Flutter-demo8.png)  
    
 
## 2.2 State çš„ç”Ÿå‘½å‘¨æœŸ

ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ**StatefulWidget** ä¼šè¦æ±‚æä¾›ä¸€ä¸ªå«æœ‰è§†å›¾æ ‘çš„ **State**ã€‚

æ—¢ç„¶ **State** èƒ½å¤Ÿæ§åˆ¶ä¸€ä¸ªè§†å›¾çš„çŠ¶æ€ï¼Œé‚£å®ƒè‚¯å®šä¼šæœ‰ä¸€ç³»åˆ—çš„ç”Ÿå‘½å‘¨æœŸã€‚

![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/Stateç”Ÿå‘½å‘¨æœŸ2.png)

ä¸Šå›¾å°±æ˜¯ State çš„ç”Ÿå‘½å‘¨æœŸå›¾ã€‚  

1. `StatefulWidget.createState()` 
    
    Framework è°ƒç”¨ä¼šé€šè¿‡è°ƒç”¨
   `StatefulWidget.createState()` æ¥åˆ›å»ºä¸€ä¸ª Stateã€‚

2. `initState()`  
    
    æ–°åˆ›å»ºçš„ State ä¼šå’Œä¸€ä¸ª **BuildContext** äº§ç”Ÿå…³è”ï¼Œæ­¤æ—¶è®¤ä¸º
   State å·²ç»è¢«å®‰è£…å¥½äº†ï¼Œ`initState()` å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚  
   
   é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚  
   
3. `didChangeDependencies()`  
    
    åœ¨ `initState()` è°ƒç”¨ç»“æŸåï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚  
    
    äº‹å®ä¸Šï¼Œå½“ State å¯¹è±¡çš„ä¾èµ–å…³ç³»å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™ä¸ªå‡½æ•°æ€»ä¼šè¢« Framework è°ƒç”¨ã€‚  
    
4. `build()`  
    
    ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œç³»ç»Ÿè®¤ä¸ºä¸€ä¸ª State å·²ç»å‡†å¤‡å¥½äº†ï¼Œå°±ä¼šè°ƒç”¨ `build()` æ¥æ„å»ºè§†å›¾ã€‚  
    
    æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè¿”å›ä¸€ä¸ª Widgetã€‚  
    
    
5. `deactivate()`  
    
    å½“ State è¢«æš‚æ—¶ä»è§†å›¾æ ‘ä¸­ç§»é™¤æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚  
    
    é¡µé¢åˆ‡æ¢æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨å®ƒï¼Œå› ä¸ºæ­¤æ—¶ State
    åœ¨è§†å›¾æ ‘ä¸­çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦å…ˆæš‚æ—¶ç§»é™¤åæ·»åŠ ã€‚
    
    âš ï¸æ³¨æ„ï¼Œé‡å†™çš„æ—¶å€™å¿…é¡»è¦è°ƒç”¨ `super.deactivate()`ã€‚
    
 
6. `dispose()`
    
    å½“ State è¢«æ°¸ä¹…çš„ä»è§†å›¾æ ‘ä¸­ç§»é™¤ï¼ŒFramework ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚  
    
    åœ¨é”€æ¯å‰è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæœ€ç»ˆçš„èµ„æºé‡Šæ”¾ã€‚  
    
    åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨ `deactivate()`ã€‚
    
    âš ï¸æ³¨æ„ï¼Œé‡å†™çš„æ—¶å€™å¿…é¡»è¦è°ƒç”¨ `super.dispose()`ã€‚


7. `didUpdateWidget(covariant T oldWidget)`  
    
    å½“ widget çš„é…ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚  
    
    æ¯”å¦‚ï¼Œ**Hot-reload** çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚  
    
    è¿™ä¸ªå‡½æ•°è°ƒç”¨åï¼Œä¼šè°ƒç”¨ `build()`ã€‚  
    
8. `setState()`  
    
    å½“æˆ‘éœ€è¦æ›´æ–° State çš„è§†å›¾æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè§¦å‘ `build()` ã€‚