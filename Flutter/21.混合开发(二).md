[![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/Flutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—å°é¢2.JPG)](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)

[**ç›®å½•ä¼ é€é—¨ï¼š**ã€ŠFlutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—ã€‹å…ˆå¯¼ç¯‡](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)


åœ¨ [æ··åˆå¼€å‘(ä¸€)]() ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸçš„åœ¨åŸç”Ÿ Android é¡¹ç›®ä¸­å¼•å…¥äº† Flutterï¼Œæœ¬ç¯‡æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è®© Flutter åœ¨åŸç”Ÿ Android åº”ç”¨ä¸­è¿è¡Œèµ·æ¥ã€‚

# 1. æ”¹é€  main.dart

é¦–å…ˆï¼Œè¦è®© Flutter çš„è§†å›¾èƒ½å±•ç¤ºï¼Œéœ€è¦æ”¹é€ ä¸€ä¸‹ `main.dart` ï¼Œæ ¹æ® name çš„æ¥åˆ›å»ºå¯¹åº”çš„ Widgetã€‚

```
import 'dart:ui';
import 'package:flutter/material.dart';

void main() => runApp(_widgetForRoute(window.defaultRouteName));

Widget _widgetForRoute(String route) {
  switch (route) {
    case 'route1':
      return SomeWidget(...);
    case 'route2':
      return SomeOtherWidget(...);
    default:
      return Center(
        child: Text('Unknown route: $route', textDirection: TextDirection.ltr),
      );
  }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡ window å¯¹è±¡è·å–äº† `defaultRouteName`ï¼Œè¿™ä¸ªå€¼æ˜¯ç”±åŸç”Ÿ Android ä¼ é€’è¿‡æ¥çš„ã€‚

åœ¨ Flutter ä¸­ï¼ŒWindow æ˜¯å¹³å°ç”¨æˆ·ç•Œé¢çš„æŠ½è±¡ï¼Œå…¶ä¸­åŒ…å«äº†å¹³å°çš„å±æ€§ã€‚

# 2. åˆ›å»º FlutterView

Flutter ä½¿ç”¨ FlutterView æ¥ä½œä¸ºå®¹å™¨ï¼Œæ˜¾ç¤º Flutter çš„è§†å›¾ã€‚

FlutterView å®é™…ä¸Šæ˜¯ä¸€ä¸ª **SurfaceView** ï¼ˆè¿™æ˜¯ä¸ªå‘æ¯”è¾ƒå¤šçš„ Viewï¼‰ï¼ŒFlutter ä¼šå°†å†…å®¹ç›´æ¥ç»˜åˆ¶åˆ° SurfaceView ä¸Šã€‚

æ€§èƒ½ç†è®ºä¸Šæ¥è¯´ï¼Œæ¯” Android æä¾›çš„åŸç”Ÿ View è‚¯å®šä¼šé«˜ã€‚

çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ª FlutterView å§ï¼š  

```
FlutterView flutterView = Flutter.createView(
   activity,
   getLifecycle(),
   "route0"
);
```

å–”ï¼Œå®ƒçœ‹èµ·æ¥å¾ˆç®€å•ã€‚

æœ€åä¸€ä¸ªå‚æ•° `route0` å°±å¯¹åº”ç€å‰é¢æ‰€è¯´çš„ `window.defaultRouteName` çš„å€¼äº†ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ›å»º FlutterView çš„æ—¶å€™ï¼Œéœ€è¦æä¾›ä¸€ä¸ª **Lifecycle**ï¼Œç”¨äºç›‘å¬ Activity çš„ç”Ÿå‘½å‘¨æœŸã€‚

å› æ­¤ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ **AppCompatActivity**ï¼Œå®ƒå·²ç»åŒ…å«äº†ä¸€ä¸ª `Lifecycle` å®ä¾‹ã€‚

æˆ–è€…ï¼Œä½ å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ª `Lifecycle`ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```
public class SupportActivity extends Activity implements LifecycleOwner {

  private LifecycleRegistry lifecycle = new LifecycleRegistry(this);
}
```

FlutterView ä½œä¸ºä¸€ä¸ª **SurfaceView** çš„å­ç±»ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª Viewã€‚

å› æ­¤ï¼Œä½ å¯ä»¥å°†å®ƒè®¾ç½®çš„è¶³å¤Ÿå¤§ï¼Œç”¨æ¥ä½œä¸ºä¸€ä¸ªé¡µé¢ã€‚  

ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œç›´æ¥æ’å…¥åˆ°ç°æœ‰ ViewTree çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½œä¸º Android åŸç”Ÿé¡µé¢ä¸­çš„ä¸€ä¸ª Viewã€‚

çµæ´»æ€§è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œæ€»ä¹‹å°±åƒä½¿ç”¨ä¸€ä¸ªåŸç”Ÿçš„Viewä¸€æ ·ä½¿ç”¨å®ƒå°±å¥½äº†ã€‚

ä¸‹é¢çš„ **gif** å°±æ˜¯ä¸€ä¸ªç”±åŸç”Ÿ Android åº”ç”¨è·³è½¬åˆ° Flutter é¡µé¢çš„ä¾‹å­ï¼š  

![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/æ··åˆå¼€å‘demo.gif)  

# 3. ç»§ç»­ä½¿ç”¨ Hot-Reload

ä½ å¯èƒ½ä¼šæ‹…å¿ƒï¼Œå’ŒåŸç”Ÿçš„Androidæ··åˆå¼€å‘äº†ä¹‹åï¼ŒHot-Reload ä¼šä¸ä¼šä¸èƒ½ç”¨äº†ï¼Ÿ  

å½“ç„¶ä¸ä¼šï¼ä½ ä»ç„¶å¯ä»¥ç»§ç»­äº«ç”¨ Hot-Reload å¸¦æ¥çš„è‰¯å¥½ç¼–è¯‘å¼€å‘ä½“éªŒã€‚  

```
// è¿›å…¥ä½ çš„ FlutterModule ç›®å½•
$ cd some/path/my_flutter
// è¿è¡Œ attach
$ flutter attach
Waiting for a connection from Flutter on Nexus 5X...
```

æ¥ç€ï¼Œåœ¨è®¾å¤‡ä¸Šå¯åŠ¨ä½ çš„é¡¹ç›®ï¼Œç„¶åè¿›å…¥åˆ°ä½¿ç”¨äº† Flutter çš„é¡µé¢ï¼Œæ§åˆ¶å°å°±ä¼šå‡ºç°ä»¥ä¸‹ä¿¡æ¯ï¼š

```
Done.
Syncing files to device Nexus 5X...                          5.1s

ğŸ”¥  To hot reload changes while running, press "r". To hot restart (and rebuild state), press "R".
An Observatory debugger and profiler on Nexus 5X is available at: http://127.0.0.1:59556/
For a more detailed help message, press "h". To quit, press "q".
```

ç°åœ¨ï¼Œå½“ä½ åœ¨ FlutterModule ä¸­æœ‰ä»»ä½•çš„ä¿®æ”¹ï¼Œåªéœ€è¦æŒ‰ä¸‹ `r` å°±èƒ½çœ‹åˆ°å˜åŒ–ã€‚ 

åœ¨è¿™ç§ç¯å¢ƒä¸‹ï¼Œä½ å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ“ä½œï¼š   

|å‘½ä»¤|åŠŸèƒ½|
|---|---|
|r|reloadï¼ˆçƒ­é‡è½½ï¼‰|
|R|restartï¼ˆçƒ­é‡å¯ï¼‰|
|q|é€€å‡º|
