[![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/Flutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—å°é¢2.JPG)](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)

[**ç›®å½•ä¼ é€é—¨ï¼š**ã€ŠFlutterå¿«é€Ÿä¸Šæ‰‹æŒ‡å—ã€‹å…ˆå¯¼ç¯‡](https://juejin.im/post/5c8f8e62e51d456a0f23d0fe)


åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒFlutter å·²ç»æä¾›äº† 30 å¤šç§ä¸åŒçš„ Widget ç”¨äºç»„åˆæ„å»ºè§†å›¾ã€‚

ä½†å¯¹äºä¸€äº›å¤æ‚çš„è§†å›¾ï¼Œç”¨ SDK æä¾›çš„è¿™äº› Widget ä»ç„¶æ— æ³•ç»„åˆå‡ºæ¥ ğŸ™ƒ ã€‚

æˆ‘ä»¬å¿…é¡»è‡ªå·±ç»˜åˆ¶è¿™äº›è§†å›¾ï¼Œå°±åƒåœ¨ Android ä¸­ä½¿ç”¨ Canvas å’Œ Paint æ¥è¿›è¡Œç»˜åˆ¶é‚£æ · ğŸ¥³ ã€‚

åœ¨ Flutter ä¸­ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯ä»¥è®©ä½ è‡ªç”±ç»˜åˆ¶çš„æ–¹æ¡ˆï¼Œä»–å°±æ˜¯ **CustomPaint**ã€‚


# CustomPaint

CustomPaint ä¹Ÿæ˜¯ä¸€ä¸ª Widgetã€‚

ä½ å¯æŠŠå®ƒåµŒåˆ°è§†å›¾æ ‘çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä½ç½®ã€‚

å…ˆçœ‹çœ‹å®ƒçš„å¸¸ç”¨å±æ€§ï¼š

|å±æ€§|ç±»å‹|è¯´æ˜|
|---|---|---|
|painter|CustomPainter|èƒŒæ™¯ç”»ç¬”ï¼Œç»˜åˆ¶å†…å®¹ä¼šæ˜¾ç¤ºåœ¨childå­èŠ‚ç‚¹åé¢|
|foregroundPainter|CustomPainter|å‰æ™¯ç”»ç¬”ï¼Œç»˜åˆ¶å†…å®¹ä¼šæ˜¾ç¤ºåœ¨childå­èŠ‚ç‚¹å‰é¢|
|size|Size|è®¾ç½®ç»˜åˆ¶åŒºåŸŸçš„å¤§å°ã€‚å¦‚æœæœ‰childï¼Œåˆ™å¿½ç•¥è¯¥å‚æ•°ï¼Œä¸”ç»˜åˆ¶åŒºåŸŸä¸ºchildçš„å°ºå¯¸|
|isComplex|bool|æ˜¯å¦å¤æ‚çš„ç»˜åˆ¶ï¼Œå¦‚æœæ˜¯ï¼ŒFlutterä¼šåº”ç”¨ä¸€äº›ç¼“å­˜ç­–ç•¥æ¥å‡å°‘é‡å¤æ¸²æŸ“çš„å¼€é”€ã€‚é»˜è®¤false|
|willChange|bool|å’ŒisComplexé…åˆä½¿ç”¨ï¼Œå½“å¯ç”¨ç¼“å­˜æ—¶ï¼Œè¯¥å±æ€§ä»£è¡¨åœ¨ä¸‹ä¸€å¸§ä¸­ç»˜åˆ¶æ˜¯å¦ä¼šæ”¹å˜ã€‚é»˜è®¤false|
|child|Widget|æ²¡é”™ï¼ŒCustomPaintæ˜¯å¯ä»¥åŒ…å«ä¸€ä¸ªå­èŠ‚ç‚¹çš„|

ä» CustomPaint çš„å±æ€§å¯ä»¥çœ‹å‡ºï¼Œå®é™…ç»˜åˆ¶æ˜¯é€šè¿‡ **CustomPainter** æ¥å®Œæˆçš„ã€‚

ä»¥ child ä¸ºåŸºå‡†ï¼Œ**CustomPainter** åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç»˜åˆ¶åœ¨ child ä¸Šé¢çš„ `pinter`ï¼Œä¸€ä¸ªæ˜¯ç»˜åˆ¶åœ¨ child ä¸‹é¢çš„ `foregroundPainter`ã€‚

ğŸŒ° çœ‹ä¸ªä¾‹å­ï¼š

```
CustomPaint(
    isComplex: true,
    willChange: true,
    size: Size(deviceSize.width, deviceSize.height),
    painter: GamePainter(background, maliao, position),
    foregroundPainter: ForegroundGamePainter(),
  )
```

# é©¬è‰¯ç¥ç¬” CustomPainter

**CustomPainter** æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½ éœ€è¦ç»§æ‰¿å®ƒå®ç°è‡ªå·±çš„é€»è¾‘ã€‚

```
class MyPainter extends CustomPainter {

  @override
  paint(Canvas canvas, Size size)  {
    ...
  }

  @override
  bool shouldRepaint(CustomPainter oldDelegate) {
    return true;
  }
}
```

ç»§æ‰¿ **CustomPainter** æœ€é‡è¦çš„æ˜¯å®ç° `paint(Canvas canvas, Size size)` å’Œ `shouldRepaint(CustomPainter oldDelegate)` è¿™ä¸¤ä¸ªå‡½æ•°ã€‚

- `paint()` ä¸­æ˜¯ç»˜åˆ¶é€»è¾‘ï¼Œå¯ä»¥åœ¨è¿™è·å¾—ç”»å¸ƒ **Canvas** å’Œ ç”»å¸ƒçš„å¤§å° **Size**ã€‚

- `shouldRepaint()` è¿”å› true æ‰ä¼šè¿›è¡Œé‡ç»˜ï¼Œå¦åˆ™å°±åªä¼šç»˜åˆ¶ä¸€æ¬¡ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€äº›æ¡ä»¶åˆ¤æ–­æ¥å†³å®šæ˜¯å¦æ¯æ¬¡ç»˜åˆ¶ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚

å®ç° **CustomPainter** æœ€é‡è¦çš„å°±æ˜¯åœ¨ `paint()` ä¸­å†™ç»˜åˆ¶é€»è¾‘ã€‚

ğŸŒ° ä¸€ä¸ªä¾‹å­ï¼š

```
class MyPainter extends CustomPainter {
  @override
  void paint(ui.Canvas canvas, ui.Size size) {
    Paint paint = Paint()
      ..isAntiAlias = true
      ..color = Colors.blueAccent
      ..strokeWidth = 10
      ..style = PaintingStyle.fill;

    canvas.drawLine(Offset(10, 10), Offset(250, 250), paint);
  }

  @override
  bool shouldRepaint(CustomPainter oldDelegate) {
    return true;
  }
}
```

ğŸ–¼ çœ‹çœ‹æ•ˆæœï¼š

![](https://raw.githubusercontent.com/chenBingX/img/master/Flutter/custompainter1.png)

åœ¨ç»˜åˆ¶è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„è§’è‰²ï¼š**Paint** å’Œ **Canvas**ã€‚

## Paint

Paint æ˜¯ç”»ç¬”ï¼Œåœ¨ **Canvas** ä¸Šä½œç”»å°±æ˜¯ä¾é å®ƒå» "æ‰§è¡Œ" çš„ã€‚

çœ‹çœ‹ Paint æœ‰é‚£äº›å¸¸ç”¨å±æ€§ï¼š

|å±æ€§|ç±»å‹|è¯´æ˜|
|---|---|---|
|isAntiAlias|bool|æ˜¯å¦å¼€å¯æŠ—é”¯é½¿ï¼Œå¼€å¯æŠ—é”¯é½¿èƒ½å¤Ÿæ˜¯è¾¹ç¼˜å¹³æ»‘ï¼Œå½“ç„¶ä¹Ÿæ›´æ¶ˆè€—ç³»ç»Ÿèµ„æº|
|color|Color|é¢œè‰²|
|colorFilter|ColorFilter|ä¼šå¯¹é¢œè‰²è¿›è¡Œå˜æ¢|
|filterQuality|FilterQuality|è®¾ç½®ç»˜åˆ¶çš„å›¾åƒè´¨é‡|
|invertColors|bool|æ˜¯å¦ä½¿ç”¨åå‘é¢œè‰²ã€‚ç»˜åˆ¶å›¾ç‰‡æ—¶ä¹Ÿèƒ½å¤Ÿåè½¬å›¾ç‰‡çš„é¢œè‰²|
|maskFilter|MaskFilter|è®¾ç½®é®ç½©æ•ˆæœã€‚æ¯”å¦‚é«˜æ–¯æ¨¡ç³Š|
|shader|Shader|æ¸å˜é¢œè‰²ã€‚ä¼šè¦†ç›–color|
|strokeCap|StrokeCap|è®¾ç½®ç»˜åˆ¶å½¢çŠ¶çš„è¾¹ç¼˜é£æ ¼ã€‚å¦‚åœ†è§’ã€æ–¹å½¢ç­‰|
|strokeJoin|StrokeJoin|è®¾ç½®ä¸¤ä¸ªç»˜åˆ¶å½¢çŠ¶è¡”æ¥å¤„çš„é£æ ¼ã€‚å¦‚åœ†è§’ã€æ–¹å½¢ç­‰|
|strokeWidth|double|ç”»ç¬”çš„å®½åº¦|
|style|PaintingStyle|å¡«å……æ–¹å¼ã€‚PaintingStyle.fill-å……æ»¡ï¼›PaintingStyle.stroke-ç©ºå¿ƒ|
|blendMode|BlendMode|åƒç´ æ··åˆæ¨¡å¼ã€‚å½“ç”»ä¸€ä¸ªshapeæˆ–è€…åˆæˆå›¾å±‚çš„æ—¶å€™ä¼šç”Ÿæ•ˆã€‚|

ä»¥ä¸Šå°±æ˜¯ Paint å¸¸ç”¨çš„å±æ€§ï¼Œä½ å¯ä»¥éƒ½è¯•è¯•çœ‹çœ‹æ•ˆæœã€‚

è¿™æ˜¯ä¸€æ®µ Paint çš„é…ç½®ä»£ç ï¼š

```
Paint paint = Paint()
  ..isAntiAlias = true
  ..color = Colors.redAccent
  ..strokeWidth = 10
  ..style = PaintingStyle.fill
  ..filterQuality = FilterQuality.high
  ..strokeCap = StrokeCap.round
  ..strokeJoin = StrokeJoin.round
  ..maskFilter = MaskFilter.blur(BlurStyle.normal, 50)
  ..invertColors = false
  ..blendMode = BlendMode.color
  ..shader = ui.Gradient.linear(
      Offset(0, 0), Offset(100, 100), [Colors.red, Colors.blueAccent])
```

## Canvas

**Canvas** ä½œä¸ºç”»å¸ƒï¼Œå®ƒå’Œåœ¨ Android ä½¿ç”¨çš„ Canvas åœ¨å¾ˆå¤šæ¥å£ä¸Šå¾ˆåƒã€‚

å®ƒåŒ…å«äº†å¾ˆå¤šåŸºç¡€çš„ç»˜åˆ¶æ“ä½œï¼Œé€šè¿‡ç»„åˆè¿™äº›åŸºç¡€çš„ç»˜åˆ¶æ“ä½œï¼Œå¯ä»¥ç»˜åˆ¶å‡ºå‡ ä¹ä»»ä½•çš„è§†å›¾ã€‚

Canvas çš„æ“ä½œä¸»è¦æœ‰ä¸¤ç±»ï¼š

- é’ˆå¯¹ Canvas çš„å˜æ¢æ“ä½œï¼Œå¦‚å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ã€å›¾å±‚ç­‰æ“ä½œã€‚

- ç»˜åˆ¶åŸºç¡€å›¾å½¢çš„æ“ä½œï¼Œå¦‚çº¿æ®µã€è·¯å¾„ã€å›¾ç‰‡ã€å‡ ä½•å›¾å½¢ç­‰ã€‚

Canvas çš„è¿™äº›æ“ä½œåç»­å†è¯¦ç»†è®²è§£ ğŸ˜‰ã€‚






